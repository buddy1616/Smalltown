<!doctype html>
<html lang="en">
<head>
	<title>Smalltown</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="0">
	<style>
		html *
		{
			font-size: 2.5vh;
			touch-action: manipulation;
		}

		body, html
		{
			height: 100%;
			margin: 0;
			padding: 0;
			width: 100%;
		}
		body
		{
			background: #000000;
			font-family: Arial;
			margin: 0;
		}
		h1
		{
			font-size: 4vh;
			margin-bottom: .5vh;
			margin-top: .5vh;
			text-align: center;
		}
		h2, h3, h4, h5
		{
			font-size: 1em;
			font-weight: normal;
			margin: 0;
			padding: 0;
		}
		div
		{
			vertical-align: top;
		}
		button
		{
			cursor:pointer;
			overflow-x: hidden;
			white-space: nowrap;
		}
		p
		{
			margin: 0 0 1vh 0;
			padding: 0;
		}
		ul
		{
			list-style: none;
			margin: 0;
			padding: 0 0 0 .5vh;
		}
		
		/* landscape */
		@media (min-aspect-ratio: 4/3)
		{
			#gameBox
			{
				width: 112vh;
			}
			#narrationBox
			{
				display: inline-block;
				vertical-align: top;
				height: 90vh;
				width: 53vh;
			}
			#controlsBox
			{
				display: inline-block;
				vertical-align: top;
				width: 53vh;
			}
			#viewBox
			{
				height: 80vh;
			}
			#layout-main
			{
				height: 80vh;
			}
			#view-currentArea
			{
				height: 79vh;
			}
			#tabBox
			{
				height: 63vh;
			}
			.tabcontent
			{
				height: 55vh;
			}
		}

		/* portrait */
		@media (max-aspect-ratio: 4/3)
		{
			#gameBox
			{
				width: 56vh;
			}
			#narrationBox
			{
				display: block;
				height: 20vh;
				margin: 5px;
			}
			#viewBox
			{
				height: 60vh;
			}
			#layout-main
			{
				height: 60vh;
			}
			#view-currentArea
			{
				height: 59vh;
			}
			#tabBox
			{
				height: 43vh;
			}
			.tabcontent
			{
				height: 35vh;
			}
		}
		
		#narrationBox
		{
			color: #000000;
			padding: 0 10px 0 10px;
			border: 1px solid;
			overflow-y: auto;
		}
		#gameBox
		{
			height: 99vh;
			margin-left: auto;
			margin-right: auto;
			padding-top: .5vh;
			text-align: center;
			background: #ffffff;
		}
		#view-currentArea
		{
			border: 1px solid;
		}		
		
		#navigationButtons
		{
			text-align: center;
		}
		
		#miniCalendar
		{
			text-align: center;
		}
		
		.tabcontent
		{
			overflow-y: scroll;
		}
		.itemTable
		{
			width: 100%;
		}
		.itemTable tbody tr td:first-child
		{
			text-align: left;
		}
		.itemTable tbody tr td:last-child
		{
			text-align: right;
		}
		
		/* layout styles */
		.subcontent
		{
			display: none;
		}
		
		/* screen styles */
		#content-pregame
		{
			background: #ffffff;
		}
		
		/* object styles */
		.narrationMessage
		{
			text-align: left;
			text-size: 0.8em;
		}
		.signTextNarrationMessage
		{
			text-align: center;
			font-style: italic;
			text-size: 0.8em;
			border: 1px solid;
			margin: 0 3vh 3vh 3vh;
			padding: 1vh;
		}
		.stackedEmoji ~ .stackedEmoji
		{
			position: relative;
			left: -2.25vh;
		}
		.stackedEmoji ~ .stackedEmoji ~ .stackedEmoji
		{
			position: relative;
			left: -4.5vh;
		}
		.stackedEmoji ~ .stackedEmoji ~ .stackedEmoji ~ .stackedEmoji
		{
			position: relative;
			left: -6.75vh;
		}
		.stackedEmoji ~ .stackedEmoji ~ .stackedEmoji ~ .stackedEmoji ~ .stackedEmoji
		{
			position: relative;
			left: -9vh;
		}
		.sunEmoji
		{
			color: #ffff33;
		}
		.moonEmoji
		{
			color: #ccccff;
		}
		.morning
		{
			background: #bbddff;
			color: #000000;
		}
		.tabcontrols
		{
			border-bottom: 1px solid;
		}
		.tabcontrol
		{
			color: #000000;
			position: relative;
			display: inline-block;
			border-top: 1px solid;
			border-left: 1px solid;
			border-right: 1px solid;
			border-radius: .5vh .5vh 0 0;
			padding: .5vh;
			vertical-align: bottom;
		}
		.tabcontrol[data-selected="true"]
		{
			background: #ffffff;
			height: 3.1vh;
			top: 1px;
		}
		.tabcontrol[data-selected="false"]
		{
			background: #cccccc;
			height: 2.5vh;
		}
		
		.skillInterface
		{
			display: none;
		}
		
		/* button styles */
		.menuButton
		{
			border: .1vh solid #000000;
			color: #ffffff;
			font-size: 4vh;
			height: 10vh;
			margin: .2vh .1vh .2vh .1vh;
			width: 30%;
			white-space: normal;
			word-wrap: break-word;
		}
		.navButton
		{
			width: 45%;
		}
		.navButton:disabled
		{
			opacity: 50%;
		}
		.featureActionButton
		{
			
		}
		.greenButton
		{
			background: #00aa00;
			color: #ffffff;
		}
		.ochreButton
		{
			background: #ddaa00;
			color: #000000;
		}
		.redButton
		{
			background: #aa0000;
			color: #ffffff;
		}
		.blueButton
		{
			background: #0000aa;
			color: #ffffff;
		}
	</style>
	<script> // constants
		var LEFT_ARROW = '&#x2B05;';
		var RIGHT_ARROW = '&#x27A1;';
		var UP_ARROW = '&#x2B06;';
		var DOWN_ARROW = '&#x2B07;';
		
		var DYNAMITE_ICON = '&#x1F9E8;';
		var GEAR_ICON = '&#x2699;';
		var HEART_ICON_BLACK = '<span style="color: #000000;">&#x2764;</span>';
		var HEART_ICON_RED = '<span style="color: #FF0000;">&#x2764;</span>';
		var INSPECT_ICON = '&#x1F50D;';
		var LOCK_ICON = '&#x1F512;';
		var MOON_ICON = '&#x1F319;';
		var STAR_ICON = '&#x2B50;';
		var SUN_ICON = '&#x2600;';
		var HOURGLASS_ICON = '&#x23F3;';
	</script>
	<script> // shortcut functions
		function g(e) { return document.getElementById(e); }
		function ce(e) { return document.createElement(e); }
	</script>
	<script> // object templates
		function newCalendarState(season, day, minutes)
		{
			return {
				season: season,
				dayOfSeason: day,
				minutes: minutes
			};
		}
		function newCalendarState_Standard()
		{
			return newCalendarState(seasons.SPRING, 0, 360)
		}
		function newSkill(id, name, desc, level)
		{
			return {
				id: id,
				displayName: name,
				description: desc,
				level: level
			};
		}
		function newSkillSet()
		{
			return {
				cooking: newSkill('cooking', 'Cooking', 'Your ability to cook food. The higher level this skill is, the more recipes you know and the better the cooking results will be.', 0),
				earlyBird: newSkill('earlyBird', 'Early Bird', 'Early birds get the worm. The higher this skill is, the earlier you wake up, and the less sleep you need each night to start with 100% stamina. Currently this skill wakes you up %EARLYBIRDMIN% minute(s) earlier.', 0),
				fishing: newSkill('fishing', 'Fishing', 'Using a rod, net or traps to pull creatures from the water. Higher skill levels increase the chance to encounter and catch fish that are more difficult to land.', 0),
				foraging: newSkill('foraging', 'Foraging', 'Harvesting wild plants. Each level increase the yield by approximately 6% and has a 1% chance to grant a bonus yield of higher quality.', 0),
				nightOwl: newSkill('nightOwl', 'Night Owl', 'This is your ability to stay up late. Each level increases your bedtime. Currently this skill delays your bedtime by %NIGHTOWLMIN% minute(s).', 0)
			};
		}
		function newTool(id, name, descs, tip, level)
		{
			return {
				id: id,
				displayName: name,
				descriptions: ['', ...descs],
				toolTip: tip,
				level: level
			};
		}
		function newToolSet()
		{
			return {
				cookingSet: newTool('cookingSet', 'Cooking Set', ['Just a few old knives and a beat up pot. It\'ll get you started.', 'A few nice utensils, pots and pans.', 'A good set of cooking gear for aspiring chef.', 'A professional cooking set.', 'An exceptional quality cooking set up, for accomplished chefs only.'], 'Useful for preparing and combining cooking ingredients, and cooking recipes.', 0),
				fishingNet: newTool('fishingNet', 'Fishing Net', ['A rotten, old net with lots of broken string.', 'A decent net for a beginner.', 'A good quality net, it should catch lots of fish.', 'A high quality net, like the professionals use.', 'An exceptional quality net.'], 'Useful for catching lots of small fish in water. Doesn\'t require bait.', 0),
				fishingRod: newTool('fishingRod', 'Fishing Rod', ['A crumby, old rod.', 'A decent beginning rod.', 'A good hobbist rod.', 'A high quality professional rod.', 'An exceptional quality, high performance fishing rod.'], 'Useful for catching fish in water. Requires bait.', 0),
				shovel: newTool('shovel', 'Shovel', ['A rusty, chipped, splintery, old, shovel.', 'A decent shovel, nothing special.', 'A good quality, sturdy, shovel.', 'A high quality shovel, should last a long time.', 'An exceptional quality shovel.'], 'Useful for digging in the earth.', 0)
			};
		}
		function newCharacterState()
		{
			return {
				name: '',
				sex: 0,
				appearance: newCharacterAppearance(),
				homeProperty: '',
				health: 0,
				maxHealth: 0,
				stamina: 0,
				maxStamina: 0,
				money: 0,
				lastBedtime: 0,
				currentArea: '',
				skills: newSkillSet(),
				tools: newToolSet(),
				inventory: [],
				boon: 0,
				relationships: [],
				ownedAreas: [],
				knownRecipes: [],
				cookedRecipes: {},
				quests: []
			};
		}
		function newGamePreferences()
		{
			return {
				areaTabOnTravel: true
			};
		}
		function newGamePreferences_Standard()
		{
			var gp = newGamePreferences();
			return gp;
		}
		
		function newWorldState()
		{
			return {
				foragedThisWeek: []
			};
		}
		
		function newArea(id, name, feats, exits, onEnter)
		{
			return {
				id: id,
				name: name,
				features: [...feats],
				exits: [...exits],
				onEnter: onEnter
			};
		}
		function newCharacterState_Standard()
		{
			var r = newCharacterState();
			r.name = 'Bosco';
			r.homeProperty = 'HOMEPROP';
			r.health = 20;
			r.maxHealth = 20;
			r.stamina = 20;
			r.maxStamina = 20;
			r.money = 0;
			r.lastBedtime = 1440; // midnight
			r.ownedAreas.push('HOMEPROP');

			return r;
		}
		function newCharacterAppearance(height, bodyType, natHair, curHair, hairStyle, eyes, aesthetic)
		{
			return {
				height: height,
				bodyType: bodyType,
				naturalHairColor: (typeof(natHair) === 'object') ? natHair : hairColors[natHair],
				currentHairColor: (typeof(curHair) === 'object') ? curHair : hairColors[curHair],
				hairStyle: (typeof(hairStyle) === 'object') ? hairStyle : hairStyles[hairStyle],
				eyes: (typeof(eyes) === 'object') ? eyes : eyeColors[eyes],
				aesthetic: aesthetic
			};
		}
		function newItemStack(item, level, quantity)
		{
			return {
				item: item,
				level: level,
				quantity: quantity
			};
		}
		
		var currentStructId = 0;

		function newStructure(areaId, type, area, owner, value, locked, amenities, options)
		{
			var r = { id: currentStructId, type: type, inArea: area, ...structureTypes[type], value: value, owner: owner, visited: false };
			currentStructId++;
			if (locked !== null) { r.isLocked = locked };
			for (var key in options)
			{
				r[key] = options[key];
			}
			r.amenities = [];
			if (Array.isArray(amenities) && amenities.length > 0)
			{
				r.amenities.push(...amenities);
			}

			structures.push(r);
			var name = getStructureDisplayName(r);
			var newAreaId = area + '_struct_' + ((areaId !== null) ? areaId : r.id);
			areas.push(newArea(
				newAreaId, name,
				[
					newFeature('STRUCT_EXIT', 0, {displayName: 'Exit ' + name, description: 'The exit for the ' + name + '.', toArea: area}),
					...amenities],
				[],
				(options.hasOwnProperty('description')) ? options.description : ''
			));
			r.areaId = newAreaId;
			return r;
		}

		var currentFeatureId = 0;
		function newFeature(type, level, options)
		{
			var r = { id: currentFeatureId, type: type, ...featureTypes[type] };
			currentFeatureId++;
			r.level = (level !== null && level !== undefined) ? level : 0;
			
			for (var key in options)
			{
				r[key] = options[key];
			}
			features.push(r);
			return r;
		}
		
		function newExit(direction, text, accessibleText, toArea, time, stamina, conditions)
		{
			return {
				direction: direction,
				text: text,
				accessibleText: accessibleText,
				toArea: toArea, 
				time: time,
				stamina: stamina,
				conditions: conditions
			};
		}
		
		var currentNpcId = 0;
		function newNpc(firstName, lastName, age, sex, description, appearance, schedule = null, personal = null)
		{
			var npc = {
				id: currentNpcId,
				firstName: firstName,
				lastName: lastName,
				age: age,
				sex: sex,
				description: description,
				appearance: appearance,
				schedule: schedule,
				personalPreferences: personal,
				characterRelationship: newNpcRelationship(0, 0),
				conversationsToday: 0,
				conversationsToDate: 0,
				dialog: [],
				currentActivity: null
			};
			currentNpcId++;
			npcs.push(npc);
			return npc;
		}
		function newNpcSchedule(area, activity, conditions)
		{
			return {
				area: area,
				activity: activity,
				conditions: [...conditions]
			};
		}
		function newNPCWorkSchedule(area)
		{
			return newNpcSchedule(area, 'WORKING', [function(){ return isStructureOpen(area);}]);
		}
		function newNpcDialog(text, responses, conditions, after = null)
		{
			return {
				text: text,
				responses: (responses !== null) ? [...responses] : [],
				conditions: [...conditions],
				after: after
			};
		}
		function newNpcRelationship(level, partnerLevel)
		{
			return {
				level: level,
				partnerLevel: partnerLevel
			};
		}
		function newQuest(id, name, description, rewards, triggers, conditions, onComplete)
		{
			var r = {
				id: id,
				name: name,
				description: description,
				rewards: rewards,
				triggers: [...triggers],
				conditions: [...conditions],
				onComplete: onComplete,
				status: questStatuses.NOTSTARTED
			};
			quests.push(r);
			return r;
		}
	</script>
	<script> // globals
		var currentSave = {
			characterState: {},
			worldState: {},
			structures: [],
			features: [],
			npcs: [],
			gamePreferences: {},
			lastDayFinished: 0,
		};
		var characterState = {};
		var worldState = {};
		var gamePreferences = {};
		
		var firstArea = true;
		var calendarState = null;
	
		var selectedTabs = {};
		var gameHasStarted = false;
		
		var structures = [];
		var features = [];
		var npcs = [];
		var quests = [];
	</script>
	<script> //utility functions
		function isToday(m, d)
		{
			var t = new Date();
			var y = t.getFullYear();
			var isday = new Date(y, m - 1, d);

			return ((isday.getDate() == t.getDate())
					&& (isday.getMonth() == t.getMonth())
					&& (isday.getFullYear() == t.getFullYear()));
		}
		function rint(n)
		{
			return Math.floor(Math.random() * n);
		}
		function s(w)
		{
			return ((w == 1) ? '' : 's');
		}
		function n(w)
		{
			return ((['a', 'e', 'i', 'o', 'u'].includes(w.charAt(0).toLowerCase())) ? 'n' : '');
		}
		function ord(n)
		{
			var t = n % 10;
			var h = n % 100;
			if ((t == 1) && (h != 11))
			{
				return n + 'st';
			}
			if ((t == 2) && (h != 12))
			{
				return n + 'nd';
			}
			if ((t == 3) && (h != 13))
			{
				return n + 'rd';
			}
			return n + 'th';
		}
		function between(n, min, max, inclusive = true)
		{
			if (!inclusive)
			{
				return (n > min && n < max);
			}
			return (n >= min && n <= max);
		}
		
		function ucaseName(n)
		{
			return n.charAt(0).toUpperCase() + n.slice(1);
		}
		function diminish(n, c)
		{
			return Math.floor((Math.sqrt((c * n) + 1) - 1) / 2);
		}
		function softcap(n, l)
		{
			return Math.min(n, l) + Math.floor(Math.min(n, l) * (Math.max(0, n - l) / 100));
		}
		function scrollTabs(el, direction)
		{
			var w = Math.floor(gameBox.offsetWidth / 2);
			el.scroll({left: el.scrollLeft + (w * direction), top: 0, behavior: 'smooth'});
		}
		function roll(chance)
		{
			if (rint(100) + 1 <= chance)
			{
				return true;
			}
			return false;
		}
		function getRandomArrayValue(arr)
		{
			return arr[rint(arr.length)];
		}
		function getRandomWeightedResult(a, loot)
		{
			var totalWeight = 0;
			var bonus = lootBonus;
			if (Array.isArray(a))
			{
				for (var i=0;i<a.length;i++)
				{
					if (a[i].hasOwnProperty('weight'))
					{
						totalWeight += a[i].weight;
						if ((loot) && (a[i].weight < 4)) { totalWeight += bonus; }
					}
				}
				var weightIndex = rint(totalWeight);
				var weightCursor = 0;
				for (var i=0;i<a.length;i++)
				{
					if (a[i].hasOwnProperty('weight'))
					{
						weightCursor += a[i].weight;
						if ((loot) && (a[i].weight < 4)){ weightCursor += bonus; }
						if (weightIndex <= weightCursor) { return i; }
					}
				}
			}
			return null;
		}
		function deleteElement(el)
		{
			var e = g(el);
			if ((e !== null) && (e != undefined))
			{
				e.parentNode.removeChild(e);
				return true;
			}
			return false;
		}
		function serialize(ob)
		{
			return encodeURIComponent(JSON.stringify(ob));
		}
		function deserialize(str)
		{
			return JSON.parse(decodeURIComponent(str));
		}
		function encode(str)
		{
			return window.btoa(str);
		}
		function decode(str)
		{
			return window.atob(str);
		}
		function getFuncOrVar(ob, arg)
		{
			if (typeof ob === 'function')
			{
				if ((arg != null) && (arg != undefined))
				{
					return ob(arg);
				}
				return ob();
			}
			return ob;
		}
		function fixButtonTextWidths(el)
		{
			var butts = el.getElementsByTagName('button');
			for (var i=0;i<butts.length;i++)
			{
				var butt = butts[i];
				var butw = butt.clientWidth;
				if (butw > 0)
				{
					var textw = butt.scrollWidth;

					var scale = butw / textw * .9;
					for (var s=0;s<butt.getElementsByTagName('span').length;s++)
					{
						var span = butt.getElementsByTagName('span')[s];
						//span.style.webkitTransform = 'scaleX(' + scale + ')';
						//span.style.transform = 'scaleX(' + scale + ')';
						span.style.fontSize = (2.5 * scale) + 'vh';
					}
				}
			}
		}
		function clamp(n, min, max)
		{
			return Math.max(min, Math.min(max, n));
		}
		function invDir(dir)
		{
			if (dir == directions.NORTH) { return directions.SOUTH; }
			if (dir == directions.SOUTH) { return directions.NORTH; }
			if (dir == directions.EAST) { return directions.WEST; }
			if (dir == directions.WEST) { return directions.EAST; }
		}
	</script>
	<script> // time functions
		function addTime(minutes)
		{
			calendarState.minutes += minutes;
			updateClock();
		}
		function setTime(hours, minutes)
		{
			calendarState.minutes = hm(hours, minutes);
			updateDisplay();
		}
		function hm(hours, minutes = 0)
		{
			return hours * 60 + minutes;
		}
		function timeBetween(min, max, inclusive = true)
		{
			return between(calendarState.minutes, min, max, inclusive);
		}
		function isDayOfWeek(days)
		{
			if (days.includes(getDayOfWeek().code)) { return true; }
			return false;
		}
		function wait(minutes)
		{
			addTime(minutes);
			updateDisplay();
		}
	</script>
	<script> // leveled descriptors
		var sizeLevels = ['tiny', 'small', 'moderate', 'sizable', 'large', 'huge', 'immense'];
	</script>
	<script> // enums
		function newEnum()
		{
			var r = {};
			for(var i=0;i<arguments.length;i++)
			{
				r[arguments[i]] = i;
			}
			r.includes = function(s) {
				for (var key in r)
				{
					if (key == s) { return true; }
				}
				return false;
			};
			Object.freeze(r);
			return r;
		}
		var attractors = newEnum('DYED_HAIR');
		var baitTypes = newEnum('BUG', 'LIVE', 'RICH', 'SHINY', 'STINKY', 'WORM');
		var cookingFeatures = newEnum('CAMPFIRE', 'RANGE');
		var fishingMethods = newEnum('NET', 'POT', 'ROD', 'TRAP');
		var questStatuses = newEnum('NOTSTARTED', 'ACTIVE', 'AWARDED', 'COMPLETED');
		var questTriggers = newEnum('GAININVENTORYITEM', 'LEARNRECIPE');
	</script>
	<script> // items
		var items = {
			BEEF: {
				id: 'BEEF',
				displayName: 'beef',
				pluralName: 'beef',
				description: 'A cut of beef.',
				value: 5,
				maxStack: 999
			},
			BLACKBERRY: {
				id: 'BLACKBERRY',
				displayName: 'blackberry',
				pluralName: 'blackberries',
				description: 'A small black, delicious, berry.',
				value: 1,
				maxStack: 999
			},
			BREAD_CAMPFIRE: {
				id: 'BREAD_CAMPFIRE',
				displayName: 'campfire bread',
				pluralName: 'campfire bread',
				description: 'A hard, bland bread, cooked in a pot on a campfire.',
				value: 30,
				maxStack: 1
			},
			BREADKNIFE: {
				id: 'BREADKNIFE',
				displayName: 'breadknife',
				pluralName: 'breadknives',
				description: 'A very used, old, breadknife.',
				value: 0,
				maxStack: 1,
				questItem: true
			},
			BURGER_RUSTIC: {
				id: 'BURGER_RUSTIC',
				displayName: 'rustic burger',
				pluralName: 'rustic burgers',
				description: 'A very simple, bland burger made over a campfire.',
				value: 55,
				maxStack: 1
			},
			CHEFSKNIFE: {
				id: 'CHEFSKNIFE',
				displayName: 'chef\'s knife',
				pluralName: 'chef\'s knives',
				description: 'A once nice knife, it looks like its been thrown around too much.',
				value: 0,
				maxStack: 1,
				questItem: true
			},
			CLEAVER: {
				id: 'CLEAVER',
				displayName: 'cleaver',
				pluralName: 'cleavers',
				description: 'A well-loved, used meat cleaver.',
				value: 0,
				maxStack: 1,
				questItem: true
			},
			DOUGH_BASIC: {
				id: 'DOUGH_BASIC',
				displayName: 'basic dough',
				pluralName: 'basic doughs',
				description: 'An easy, basic, kneaded dough for simple breads.',
				value: 20,
				maxStack: 1
			},
			FLOUR_WHEAT: {
				id: 'FLOUR_WHEAT',
				displayName: 'wheat flour',
				pluralName: 'wheat flour',
				description: 'A fine flour made from wheat.',
				value: 5,
				maxStack: 999
			},
			KABOB_STEAK: {
				id: 'KABOB_STEAK',
				displayName: 'steak kabob',
				pluralName: 'steak kabobs',
				description: 'Skewered beef roasted over an open flame.',
				value: 20,
				maxStack: 999
			},
			MARSHMALLOW: {
				id: 'MARSHMALLOW',
				displayName: 'marshmallow',
				pluralName: 'marshmallows',
				description: 'A squishy white confection. Good for making s\'mores.',
				value: 1,
				maxStack: 999
			},
			MARSHMALLOW_ROASTED: {
				id: 'MARSHMALLOW_ROASTED',
				displayName: 'roasted marshmallow',
				pluralName: 'roasted marshmallows',
				description: 'A marshmallow, roasted over an open flame.',
				value: 2,
				maxStack: 999
			},
			POT_OLD: {
				id: 'POT_OLD',
				displayName: 'old pot',
				pluralName: 'old pots',
				description: 'A beat up, old, pot.',
				value: 0,
				maxStack: 999,
				questItem: true
			},
			SPINACH: {
				id: 'SPINACH',
				displayName: 'spinach',
				pluralName: 'spinach',
				description: 'A tasty, leafy green, rich in iron.',
				value: 10,
				maxStack: 999
			},
			SPINACH_SEED: {
				id: 'SPINACH_SEED',
				displayName: 'spinach seed',
				pluralName: 'spinach seeds',
				description: 'Seeds to grow spinach.',
				value: 5,
				maxStack: 999
			},
			YEAST: {
				id: 'YEAST',
				displayName: 'yeast',
				pluralName: 'yeast',
				description: 'A microfungus that is used in breadmaking.',
				value: 1,
				maxStack: 999
			}
		};
	</script>
	<script> // type definitions
		var directions = {
			NORTH: { abbrev: 'N', displayName: 'North', navButton: 'northNavButton', navButtonText: 'northNavButtonText'},
			EAST: { abbrev: 'E', displayName: 'East', navButton: 'eastNavButton', navButtonText: 'eastNavButtonText'},
			SOUTH: { abbrev: 'S', displayName: 'South', navButton: 'southNavButton', navButtonText: 'southNavButtonText'},
			WEST: { abbrev: 'W', displayName: 'West', navButton: 'westNavButton', navButtonText: 'westNavButtonText'}
		};
		
		var seasons = {
			SPRING: { displayName: 'Spring', abbr: 'Spr' },
			SUMMER: { displayName: 'Summer', abbr: 'Sum' },
			FALL: { displayName: 'Fall', abbr: 'Fal' },
			WINTER: { displayName: 'Winter', abbr: 'Win' }
		};
		var weekDays = [
			{ id: 0, displayName: 'Monday', abbr: 'Mon', code: 'MO' },
			{ id: 1, displayName: 'Tuesday', abbr: 'Tue', code: 'TU' },
			{ id: 2, displayName: 'Wednesday', abbr: 'Wed', code: 'WE' },
			{ id: 3, displayName: 'Thursday', abbr: 'Thu', code: 'TH' },
			{ id: 4, displayName: 'Friday', abbr: 'Fri', code: 'FR' },
			{ id: 5, displayName: 'Saturday', abbr: 'Sat', code: 'SA' },
			{ id: 6, displayName: 'Sunday', abbr: 'Sun', code: 'SU' }
		];
		
		var activities = {
			CHILLING: {displayName: 'chilling'},
			EATING: {displayName: 'eating'},
			GAMING: {displayName: 'gaming'},
			HOME: {displayName: 'going home'},
			READING: {displayName: 'reading'},
			SLEEPING: {displayName: 'sleeping'},
			STUDYING: {displayName: 'studying'},
			THINKING: {displayName: 'thinking'},
			WALKING_N: {displayName: 'walking north'},
			WALKING_E: {displayName: 'walking east'},
			WALKING_S: {displayName: 'walking south'},
			WALKING_W: {displayName: 'walking west'},
			WORKING: {displayName: 'working'}
		};
		
		var dwellingTypes = {
			NONE: { level: 0, displayName: 'None' },
			TENT: { level: 1, displayName: 'Tent' },
			HUT: { level: 2, displayName: 'Hut' },
			SHACK: { level: 3, displayName: 'Shack', description: 'An old dilapidated shack.' },
			HOVEL: { level: 4, displayName: 'Hovel' },
			BUNG: { level: 5, displayName: 'Bungalow' },
			COTTAGE: { level: 6, displayName: 'Cottage' },
			HOUSE: { level: 7, displayName: 'House' },
			ESTATE: { level: 8, displayName: 'Estate' },
			VILLA: { level: 9, displayName: 'Villa' },
			MANSION: { level: 10, displayName: 'Mansion' },
			PALACE: { level: 11, displayName: 'Palace' }
		};

		var fishTypes = {
			BLUEGILL: { level: 0, displayName: 'Bluegill', methods: [fishingMethods.ROD], favoriteBaits: [baitTypes.WORM], peakTime: 6, spring: 50, summer: 35, fall: 10, winter: 5 },
			CRAYFISH: { level: 0, displayName: 'Crayfish', methods: [fishingMethods.POT, fishingMethods.ROD], favoriteBaits: [baitTypes.RICH], peakTime: 24, spring: 5, summer: 90, fall: 5, winter: 0 },
			FATHEAD: { level: 0, displayName: 'Fathead Minnow', methods: [fishingMethods.TRAP], favoriteBaits: [baitTypes.STINKY], peakTime: 18, spring: 10, summer: 70, fall: 10, winter: 10 }
		};
		var waterTypes = {
			POND: { level: 1, displayName: 'Pond' }
		};
		var structureTypes = {
			DWELL: { dwellingType: dwellingTypes.NONE, enterAction: 'Enter %%', exitAction: 'Leave %%' },
			SHOP: { enterAction: 'Enter %%', exitAction: 'Leave %%', isLocked: function() { return !between(calendarState.minutes, hm(8, 59), hm(17), false); } }
		};
		var featureTypes = {
			STRUCT_EXIT: { },
			CAMPFIRE: { displayName: 'Camp Fire', description: 'A circle of rocks that you can load wood into and make a fire. Good for roasting marshmallows, and preparing rustic food.' },
			DEBRIS: { displayName: 'Debris', description: function(f){ return getDebrisDescription(f.level); } },
			ITEM: { canPickUp: false, canPurchase: false },
			SIGN: { displayName: 'Sign'},
			SLEEPINGBAG: { displayName: 'Sleeping Bag', description: 'A basic sleeping system. It works, but you won\'t feel totally refreshed after sleeping here.' },
			WATER: { displayName: function(f){ return f.waterType.displayName; } }
		};
		
		var forageTypes = {
			BLACKBERRY: {displayName: 'Blackberry Bush', description: 'A wild blackberry bush riddled with sharp thorns. In the summer, this bush is lush with dark, sweet, berries.', item: items.BLACKBERRY, minQuantity: 20, maxQuantity: 40, conditions: [function(){return calendarState.season == seasons.SUMMER;}]}
		};
		var sexes = ['female', 'male'];
		var hairColors = {
			AUBURN: {displayName: 'auburn'},
			BLACK: {displayName: 'black'},
			BLONDE: {displayName: 'blonde'},
			BROWN: {displayName: 'brown'},
			GREY: {displayName: 'grey'},
			RED: {displayName: 'red'},
			WHITE: {displayName: 'white'},
			BLUE: {displayName: 'blue'},
			GREEN: {displayName: 'green'},
			PINK: {displayName: 'pink'},
			PURPLE: {displayName: 'purple'}
		};
		var naturalHairColors = [
			'AUBURN',
			'BLACK',
			'BLONDE',
			'BROWN',
			'GREY',
			'RED',
			'WHITE'
		];
		var hairStyles = {
			AFRO: {displayName: 'afro'},
			BOB: {displayName: 'bob cut'},
			BUN: {displayName: 'bun'},
			CREW: {displayName: 'crew cut'},
			FLAT: {displayName: 'flat top'},
			MANBUN: {displayName: 'man-bun'},
			MOHAWK: {displayName: 'mohawk'},
			PIGTAIL: {displayName: 'pigtails'},
			PONYLOW: {displayName: 'low pony'},
			PONYHIGH: {displayName: 'high pony'},
			PONYUNDER: {displayName: 'undercut pony'},
			SPACEBUNS: {displayName: 'space buns'}
		};
		var eyeColors = {
			BLUE: {displayName: 'blue'},
			BROWN: {displayName: 'brown'},
			GREEN: {displayName: 'green'},
			HAZEL: {displayName: 'hazel'}
		};
		var aesthetics = {
			ALT: {displayName: 'alternative'},
			CASUAL: {displayName: 'casual'},
			CUTE: {displayName: 'cute'},
			DAPPER: {displayName: 'dapper'},
			HIPSTER: {displayName: 'hipster'},
			NERDY: {displayName: 'nerdy'},
			RUSTIC: {displayName: 'rustic'}
		};
		var heights = {
			TALL: {displayName: 'tall'},
			AVERAGE: {displayName: 'average'},
			SHORT: {displayName: 'short'}
		};
		var bodyTypes = {
			AVERAGE: {displayName: 'average'},
			CHUBBY: {displayName: 'chubby'},
			CURVY: {displayName: 'curvy'},
			DADBOD: {displayName: 'dad bod'},
			FIT: {displayName: 'fit'},
			THIN: {displayName: 'thin'}
		};
	
	</script>
	<script> // recipes
		var recipes = [
			{
				id: 'BREAD_CAMPFIRE',
				displayName: 'campfire bread',
				action: 'Bake Bread',
				ingredients: [newItemStack('DOUGH_BASIC', 0, 1)],
				result: newItemStack('BREAD_CAMPFIRE', 0, 1),
				time: 30
			},
			{
				id: 'DOUGH_BASIC',
				displayName: 'basic dough',
				action: 'Knead Dough',
				ingredients: [newItemStack('FLOUR_WHEAT', 0, 1), newItemStack('YEAST', 0, 1)],
				result: newItemStack('DOUGH_BASIC', 0, 1),
				time: 30
			},
			{
				id: 'KABOB_STEAK',
				displayName: 'steak kabob',
				action: 'Roast Kabob',
				ingredients: [newItemStack('BEEF', 0, 1)],
				result: newItemStack('KABOB_STEAK', 0, 1),
				time: 10
			},
			{
				id: 'MARSHMALLOW_ROASTED',
				displayName: 'roasted marshmallow',
				action: 'Roast Marshmallow',
				ingredients: [newItemStack('MARSHMALLOW', 0, 1)],
				result: newItemStack('MARSHMALLOW_ROASTED', 0, 1),
				time: 2
			},
			{
				id: 'BURGER_RUSTIC',
				displayName: 'rustic burger',
				action: 'Assemble Burger',
				ingredients: [newItemStack('BREAD_CAMPFIRE', 0, 1), newItemStack('KABOB_STEAK', 0, 1)],
				result: newItemStack('BURGER_RUSTIC', 0, 1),
				time: 2
			}
		];
	</script>
	<script> // area functions
		function getArea(id)
		{
			if (typeof(id) == 'object') { return id; }
			for (var i=0;i<areas.length;i++)
			{
				if (areas[i].id.toLowerCase() == id.toLowerCase())
				{
					return areas[i];
				}
			}
			return null;
		}
		function inspectArea(areaButton)
		{
			var a = getArea(areaButton.getAttribute('data-areaid'));
			if (a.hasOwnProperty('description'))
			{
				addNarrationMessage(handleWildcards(getFuncOrVar(a.description)));
			}
			else if (a.hasOwnProperty('onEnter'))
			{
				addNarrationMessage(handleWildcards(getFuncOrVar(a.onEnter)));
			}
			else
			{
				addNarrationMessage('No description available.');
			}
		}
		function setCurrentArea(id, fromExit)
		{
			var area = getArea(id);
			characterState.currentArea = id;
			clearNarrationBox();
			if (area.hasOwnProperty('onEnter'))
			{
				var enterText = getFuncOrVar(area.onEnter, {fromExit: fromExit});
				if (enterText === null || enterText === undefined) { enterText = getFuncOrVar(area.name); }
				addNarrationMessage(enterText);
			}

			if (firstArea)
			{
				addNarrationMessage('Use the (N:, E:, S:, W:) Navigation buttons to traverse the world\'s different areas.');
				addNarrationMessage('Some areas have a list of features that you can interact with using the controls below the navigation.');
				addNarrationMessage('Actions require time and stamina, be wary of the time of day and your stamina.');
				addNarrationMessage('Make it home by bedtime each night or you wont be well rested for the next day. Run out of stamina and you\'ll be too tired to do any work.');
				firstArea = false;
			}
			
			if (areaHasDebris(area))
			{
				addNarrationMessage('You\'ll need to clear out this debris before you start working here.');
			}
			if (gamePreferences.areaTabOnTravel)
			{
				selectTab('tabBox', 'area', 'maintabs', g('mainTab_Area'));
			}
			updateDisplay();
		}
		function areaHasDebris(area)
		{
			var a = getArea(area);
			for (var i=0;i<a.features.length;i++)
			{
				if (a.features[i].type == 'DEBRIS')
				{
					return true;
				}
			}
			return false;
		}
		function areaHasNonDebrisFeatures(area)
		{
			var a = getArea(area);
			for (var i=0;i<a.features.length;i++)
			{
				if (a.features[i].type != 'DEBRIS')
				{
					return true;
				}
			}
			return false;
		}
		function getDebrisDescription(level)
		{
			var adjs = [...sizeLevels];
			var a = adjs[Math.min(level, adjs.length-1)];
			return 'A' + n(a) + ' ' + a + ' pile of debris. You\'ll have to clear this out before you can do any work or access any features here.';
		}
		function getFeature(id)
		{
			for (var i=0;i<features.length;i++)
			{
				if (features[i].id == id)
				{
					return features[i];
				}
			}
			return null;
		}
		function getAreaFeaturesByType(area, featureType)
		{
			var a = getArea(area);
			var r = [];
			for (var i=0;i<a.features.length;i++)
			{
				if (a.features[i].type == featureType)
				{
					r.push(a.features[i]);
				}
			}
			return r;
		}

		function getFeatureDisplayName(f)
		{
			var n = f.displayName;
			if (f.type == 'ITEM' && f.hasOwnProperty('itemStack'))
			{
				n = getItem(f.itemStack.item).displayName;
			}
			return handleWildcards(getFuncOrVar(n, f));
		}
		function tryClearDebris(stamina, time, area, feature)
		{
			if (testStamina(stamina, DEFAULT_STAMINA_MESSAGE, false))
			{
				if (testTime(time, true, true))
				{
					addAlertNarration('Debris cleared.' + ((time > 60) ? ' Whew!' : ''));
					addStamina(-stamina);
					deleteFeature(area, feature);
					if (!areaHasDebris(area))
					{
						addAlertNarration('All debris has been cleared! New features and paths may now be accessible.');
					}
				}
			}
		}
		function deleteFeature(area, feature)
		{
			var a = getArea(area);
			for (var i=0;i<a.features.length;i++)
			{
				if (a.features[i].id == feature)
				{
					a.features.splice(i, 1);
				}
			}
			for (var i=0;i<features.length;i++)
			{
				if (features[i].id == feature)
				{
					features.splice(i, 1);
				}
			}
			updateFeatureTable(a);
		}
		
		function getAreaCookingFeatures(area)
		{
			var a = getArea(area);
			var r = [];
			for (var i=0;i<a.features.length;i++)
			{
				if (cookingFeatures.includes(a.features[i].type))
				{
					r.push(a.features[i]);
				}
			}
			return r;
		}
		function canCookRecipeInArea(recipe, area)
		{
			if (recipe != null && recipe != undefined && recipe != '')
			{
				var a = getArea(area);
				var r = getRecipe(recipe);
				var feats = getAreaCookingFeatures(a);
				if (feats.length > 0)
				{
					if (!r.hasOwnProperty('cookingFeatures')) { return true; }
					for (var x=0;x<feats.length;x++)
					{
						for (var y=0;y<r.cookingFeatures.length;y++)
						{
							if (r.cookingFeatures[y] == feats[x].type) { return true; }
						}
					}
				}
			}
			return false;
		}
		function updateAreaTable(a)
		{
			var x = g('areaTableBody');
			x.innerHTML = '';
			var row = ce('tr');
			var nameTd = ce('td');
			var actionTd = ce('td');
			nameTd.innerHTML = handleWildcards(getFuncOrVar(a.name));
			actionTd.appendChild(makeButton('ochreButton', function(){wait(1);}, '1m', 'Wait 1 minute'));
			actionTd.appendChild(makeButton('ochreButton', function(){wait(5);}, '5m', 'Wait 5 minutes'));
			actionTd.appendChild(makeButton('ochreButton', function(){wait(30);}, '30m', 'Wait 30 minutes'));
			actionTd.appendChild(makeButton('ochreButton', function(){inspectArea(this);}, INSPECT_ICON, 'Inspect ' + handleWildcards(getFuncOrVar(a.name)), {areaId: a.id}));
			row.appendChild(nameTd);
			row.appendChild(actionTd);
			x.appendChild(row);
		}
		function updateStructuresTable(a)
		{
			var x = g('areaStructuresBody');
			x.innerHTML = '';
			g('structuresTable').style.display = 'none';
			for (var i=0;i<structures.length;i++)
			{
				if (structures[i].inArea == a.id)
				{
					g('structuresTable').style.display = 'table';
					var struct = structures[i];

					var row = ce('tr');
					var nameTd = ce('td');
					var actionTd = ce('td');
					var n = getStructureDisplayName(struct);
					nameTd.innerHTML = n;
					if (getFuncOrVar(struct.isLocked))
					{
						actionTd.appendChild(makeFeatureActionButton(function(){clickActionButton(this, tryEnterStructure);}, LOCK_ICON, n + ' is locked', { area: a.id, structure: struct.id }));
					}
					else
					{
						actionTd.appendChild(makeFeatureActionButton(function(){clickActionButton(this, tryEnterStructure);}, 'Enter', 'Enter ' + n, { area: a.id, structure: struct.id }));
					}
					actionTd.appendChild(makeStructureInspectbutton(struct));
					row.appendChild(nameTd);
					row.appendChild(actionTd);
					x.appendChild(row);
				}
			}
		}
		function updateAreaNpcsTable(a)
		{
			var x = g('areaNpcsBody');
			x.innerHTML = '';
			g('areaNpcsTable').style.display = 'none';
			var ns = getPresentNpcs(a);
			for (var i=0;i<ns.length;i++)
			{
				g('areaNpcsTable').style.display = 'table';
				var n = ns[i];

				var row = ce('tr');
				var nameTd = ce('td');
				var actionTd = ce('td');
				nameTd.innerHTML = n.firstName + ((n.currentActivity !== null) ? ' (' + ucaseName(activities[n.currentActivity].displayName) + ')' : '');
				actionTd.appendChild(makeButton('ochreButton', function(){talkToNpc(this);}, 'Talk', 'Talk to ' + n.firstName, {npcid: n.id}));
				actionTd.appendChild(makeNpcInspectbutton(n));
				row.appendChild(nameTd);
				row.appendChild(actionTd);
				x.appendChild(row);
			}
		}
		function updateFeatureTable(a)
		{
			var x = g('areaFeaturesBody');
			x.innerHTML = '';
			g('featuresTable').style.display = 'none';
			if (a.hasOwnProperty('features'))
			{
				for (var i=0;i<a.features.length;i++)
				{
					var feat = a.features[i];
					var row = null;
					if (testConditions(characterState, feat.conditions))
					{
						g('featuresTable').style.display = 'table';
						if (feat.type == 'STRUCT_EXIT')
						{
							row = createFeatureRow(a, feat, { actionFunction: function(){clickActionButton(this, tryLeaveStructure);}, text: 'Exit', accessibleText: 'Exit', attr: { toArea: feat.toArea } });
						}			
						else
						{
							if (areaHasDebris(a))
							{
								switch (feat.type)
								{
									case 'DEBRIS':
										row = createFeatureRow(a, feat, { actionFunction: function(){clickActionButton(this, clickClearDebrisButton);}, text: 'Clear Debris', accessibleText: 'Clear Debris', attr: { area: a.id, feature: feat.id } });
										break;
								}
							}
							else
							{
								var actions = [];
								switch (feat.type)
								{
									case 'FORAGE':
										if (!worldState.foragedThisWeek.includes(feat.id))
										{
											actions.push({ actionFunction: function(){clickActionButton(this, clickForageButton);}, text: 'Forage', accessibleText: 'Forage from ' + getFeatureDisplayName(feat), attr: { area: a.id, feature: feat.id} });
										}
										break;
									case 'ITEM':
										if (feat.hasOwnProperty('actions'))
										{
											for (var key in feat.actions)
											{
												var act = feat.actions[key];
												actions.push({ actionFunction: act.actionFunction, text: act.text, accessibleText: act.accessibleText, attr: { area: a.id, feature: feat.id, ...act.attr} });
											}
										}
										if (feat.hasOwnProperty('canPickUp') && feat.canPickUp)
										{
											actions.push({ actionFunction: function(){clickActionButton(this, clickTakeItemButton);}, text: 'Take', accessibleText: 'Take ' + getFeatureDisplayName(feat), attr: { area: a.id, feature: feat.id, itemId: feat.itemStack.item, itemLevel: feat.itemStack.level, itemQuantity: feat.itemStack.quantity } });
										}
										break;
									case 'WATER':
										actions.push({ actionFunction: function(){clickActionButton(this, clickFishButton);}, text: 'Fish', accessibleText: 'Fish in ' + getFeatureDisplayName(feat), attr: { area: a.id, feature: feat.id } });
										break;
								}
								row = createFeatureRow(a, feat, actions);
							}
						}
					}
			
					if (row != null)
					{
						x.appendChild(row);
					}
				}
			}
			else
			{
				g('featuresTable').style.display = 'none';
			}
		}
		function createFeatureRow(a, feat, actions)
		{
			var row = ce('tr');
			var nameTd = ce('td');
			var actionTd = ce('td');
			nameTd.innerHTML = ucaseName(getFeatureDisplayName(feat));
			if (feat.type == 'ITEM' && feat.canPurchase && feat.hasOwnProperty('itemStack'))
			{
				var price = ce('span');
				price.innerHTML = ': $' + feat.itemStack.item.value;
				nameTd.appendChild(price);
			}
			if (feat.level > 0)
			{
				nameTd.appendChild(renderStars(feat.level, true));
			}			
			if (actions !== null && actions !== undefined)
			{
				if (Array.isArray(actions))
				{
					for (var i=0;i<actions.length;i++)
					{
						actionTd.appendChild(makeFeatureActionButton(actions[i].actionFunction, actions[i].text, actions[i].accessibleText, actions[i].attr));
					}
				}
				else
				{
					actionTd.appendChild(makeFeatureActionButton(actions.actionFunction, actions.text, actions.accessibleText, actions.attr));
				}
			}
			actionTd.appendChild(makeFeatureInspectbutton(feat));
			row.appendChild(nameTd);
			row.appendChild(actionTd);
			return row;
		}
		function updateSaleItemsTable(area)
		{
			var x = g('saleItemsBody');
			x.innerHTML = '';
			if (areaHasSaleItems(area))
			{
				for (var i=0;i<area.features.length;i++)
				{
					var row = null;
					var feat = area.features[i];
					if (feat.type == 'ITEM' && feat.canPurchase && testConditions(characterState, feat.conditions))
					{
						g('saleItemsTable').style.display = 'table';
						//TODO the prices for items shows up as undefined and NaN
						row = createFeatureRow(area, feat, [
								{ actionFunction: function(){clickActionButton(this, tryPurchaseItem);}, text: '$', accessibleText: 'Buy 1 for $' + feat.value, attr: { area: area.id, feature: feat.id, purchaseQuantity: 1 } },
								{ actionFunction: function(){clickActionButton(this, tryPurchaseItem);}, text: '$ x5', accessibleText: 'Buy 5 for $' + (feat.value * 5), attr: { area: area.id, feature: feat.id, purchaseQuantity: 5 } },
								{ actionFunction: function(){clickActionButton(this, tryPurchaseItem);}, text: '$ x10', accessibleText: 'Buy 10 for $' + (feat.value * 10), attr: { area: area.id, feature: feat.id, purchaseQuantity: 10 } }
							]);
					}
					if (row != null)
					{
						x.appendChild(row);
					}
				}
			}
			else
			{
				g('saleItemsTable').style.display = 'none';
			}
		}
		function makeFeatureActionButton(action, buttonText, accessibleText, attr)
		{
			return makeButton('ochreButton', action, buttonText, accessibleText, attr)
		}
		function makeFeatureInspectbutton(feat)
		{
			return makeButton('ochreButton', function(){inspectFeature(this);}, INSPECT_ICON, 'Inspect ' + getFeatureDisplayName(feat), {featureId: feat.id});
		}
		function makeStructureInspectbutton(struct)
		{
			return makeButton('ochreButton', function(){inspectStructure(this);}, INSPECT_ICON, 'Inspect ' + getFuncOrVar(struct.displayName), {structureId: struct.id});
		}
		function makeNpcInspectbutton(n)
		{
			return makeButton('ochreButton', function(){inspectNpc(this);}, INSPECT_ICON, 'Inspect ' + getFuncOrVar(n.firstName), {npcId: n.id});
		}

		function tryTravel(exit)
		{
			clearNarrationBox();
			if (testStamina(exit.stamina, 'You don\'t have the stamina for this trip.', false))
			{
				if (testTime(exit.time, true, false))
				{
					addStamina(-exit.stamina);
					addTime(exit.time);
					var a = getArea(exit.toArea);
					setCurrentArea(exit.toArea, exit);
				}
			}
		}
	</script>
	<script> // structure functions
		function tryEnterStructure(button)
		{
			var id = button.getAttribute('data-structure');
			if (!getFuncOrVar(structures[id].isLocked))
			{
				if (testTime(2, true, true))
				{
					enterStructure(id);
				}
			}
			else
			{
				addAlertNarration(getStructureDisplayName(id) + ' is locked.');
			}
		}
		function enterStructure(id)
		{
			var struct = structures[id];
			setCurrentArea(struct.areaId, false);
			clearNarrationBox();
			addNarrationMessage('You enter ' + getStructureDisplayName(struct) + '.');
			if (struct.hasOwnProperty('firstEnter') && !struct.visited)
			{
				addNarrationMessage(handleWildcards(struct.firstEnter));
				struct.visited = true;
			}
			else
			{
				inspectStructure(struct);
			}
		}
		function tryLeaveStructure(button)
		{
			var id = button.getAttribute('data-toarea');
			if (testTime(2, true, true))
			{
				leaveStructure(id);
			}
		}
		function leaveStructure(id)
		{
			setSubcontent('viewBox', 'currentArea');
			setCurrentArea(id, null);
		}
		function getStructureDisplayName(s)
		{
			var struct = s;
			if (typeof(struct) !== 'object')
			{
				struct = structures[s];
			}
			if (struct.type == 'DWELL')
			{
				return handleWildcards(getFuncOrVar(struct.dwellingType.displayName, struct));
			}
			else
			{
				return handleWildcards(getFuncOrVar(struct.displayName, struct));
			}
		}
		function getStructureByAreaId(area)
		{
			for (var i=0;i<structures.length;i++)
			{
				if (structures[i].areaId == area)
				{
					return structures[i];
				}
			}
			return null;
		}
		function isStructureOpen(area)
		{
			var s = getStructureByAreaId(area);
			if (s !== null && s.hasOwnProperty('isLocked')) { return !getFuncOrVar(s.isLocked); }
			return false;
		}
		function isStructureOwnedBy(area, owner)
		{
			var s = getStructureByAreaId(area);
			return (s.owner.toLowerCase() == owner.toLowerCase());
		}
	</script>
	<script> // npcs
		function newGameNpcs_Standard()
		{
			// newNpc(firstName, lastName, age, sex, description, appearance, schedule)
			// newCharacterAppearance(height, bodyType, natHair, curHair, hairStyle, eyes, aesthetic)
			// newNpcSchedule(area, activity, conditions)
			// weekdays[0] == monday
			avery();
			clayton();
			dominic();
			emma();
			liam();
			luigi();
			mateo();
			olivia();
		}
	</script>
	<script> // NPC: Avery
		function avery()
		{
			var avery = newNpc('Avery', 'Thompson', 29, 0,
				'A edgy extrovert that is totes obsessed with plants and crystals.',
				newCharacterAppearance(heights.AVERAGE, bodyTypes.AVERAGE, hairColors.BLONDE, hairColors.BLUE, hairStyles.SPACEBUNS, eyeColors.HAZEL, aesthetics.ALT),
				[
					newNPCWorkSchedule('STOWN_PL_struct_GARDENSHOP')
				]
			);
		}
	</script>
	<script> // NPC: Clayton
		function clayton()
		{
			var clayton = newNpc('Clayton', 'Lespool', 46, 1,
				'A boisterous, friendly, guy with a salt-and-pepper beard. Likes to joke around and make friends. Loves a good pun.',
				newCharacterAppearance(heights.TALL, bodyTypes.FIT, hairColors.GREY, hairColors.GREY, hairStyles.PONYLOW, eyeColors.BROWN, aesthetics.CASUAL),
				[
					newNPCWorkSchedule('STOWN_PL_struct_CLAYSDELI'),
					newNpcSchedule('STOWN_PL', 'CHILLING', [function(){ return !isStructureOpen('STOWN_PL_struct_CLAYSDELI'); }])
				]);
			clayton.dialog = [
				newNpcDialog('Hey there I haven\'t seen you around before. I\'m Clay, the butcher. KNIFE to MEAT YOU!! HAHAHA! Get it? KNIFE? MEAT? Because I\'m the butcher! HAHAHA! Anyway, stop on by the deli some time, it\'s in the Smalltown Plaza.', null,
					[function(){ return (isStructureOwnedBy('STOWN_PL_struct_CLAYSDELI', 'clayton')
									&& !isStructureOpen('STOWN_PL_struct_CLAYSDELI')
									&& getNpcByName('clayton').conversationsToDate < 1); }]
				),
				
				// quest helpers
				newNpcDialog(
						'Hey I like the CUT of your jib, kid. '
						+ 'I feel like you have the GUTS to be a great butcher. '
						+ 'I just bought a new cleaver, you can have my old one.'
					, null,
					[function(){ return (isStructureOwnedBy('STOWN_PL_struct_CLAYSDELI', 'clayton')
									&& isStructureOpen('STOWN_PL_struct_CLAYSDELI')
									&& isCharacterOnQuest('COOKING_I')
									&& getInventoryItem('CLEAVER').quantity < 1
									&& getNpcByName('clayton').conversationsToDate > 1); }],
					function() {
							tryAddItemWithMessage('CLEAVER', 0, 1);
							addNpcDialogNarration(getNpcByName('clayton'), 'Come back when you have a complete cooking set, and I\'ll show you a few things.');
						}
				),
				newNpcDialog(
						'So, you\'ve got a set of knives now eh? You\'re a CUT above the rest, HAHAHA! '
					, null,
					[function(){ return (isCharacterOnQuest('COOKING_II')
									&& getNpcByName('clayton').conversationsToday < 1); }],
					function() {
							if (testTime(30, false, false))
							{
								addNpcDialogNarration(getNpcByName('clayton'), 'I\'ll show you how to make a steak kabob!');
								learnRecipe(characterState, 'KABOB_STEAK', true);
								tryAddItemWithMessage('BEEF', 0, 1);
								addTime(30);
							}
							else
							{
								addNpcDialogNarration(getNpcByName('clayton'), 'It\'s late, but come back when you have more time. I\'ll show you how to make a basic dough.');
							}
						}
				),

				// work talk
				newNpcDialog('Welcome to Meat and Greet! You can call me Clay, KNIFE to MEAT YOU! HAHAHA! Get it? KNIFE? MEAT? Because I\'m the butcher! HAHAHA!', null,
					[function(){ return (isStructureOwnedBy('STOWN_PL_struct_CLAYSDELI', 'clayton')
									&& isStructureOpen('STOWN_PL_struct_CLAYSDELI')
									&& getNpcByName('clayton').conversationsToDate < 1); }]
				),
				newNpcDialog([
						'Howdy, take a look around, I\'ve got all the choice cuts.',
						'You need some haggis, or some tripe? I\'ve got it all! HAHAHA!'
					], null,
					[function(){ return (isStructureOwnedBy('STOWN_PL_struct_DOMSBAKERY', 'dominic')
									&& isStructureOpen('STOWN_PL_struct_DOMSBAKERY')); }]
				)
			];
		}
	</script>
	<script> // NPC: Dominic
		function dominic()
		{
			var dominic = newNpc('Dominic', 'Smith', 34, 1,
				'Slender European hipster with a goatee and a love of sourdough bread.',
				newCharacterAppearance(heights.AVERAGE, bodyTypes.THIN, hairColors.BROWN, hairColors.BROWN, hairStyles.MANBUN, eyeColors.BLUE, aesthetics.HIPSTER),
				[
					newNPCWorkSchedule('STOWN_PL_struct_DOMSBAKERY'),
					newNpcSchedule('STOWN_PL', 'CHILLING', [function(){ return !isStructureOpen('STOWN_PL_struct_DOMSBAKERY'); }])
				]
			);
			dominic.dialog = [
				newNpcDialog('Hey you\'re new in town, you should come by my bakery sometime. It\'s the Bread Poet\'s Society in the Smalltown Plaza.', null,
					[function(){ return (isStructureOwnedBy('STOWN_PL_struct_DOMSBAKERY', 'dominic')
									&& !isStructureOpen('STOWN_PL_struct_DOMSBAKERY')
									&& getNpcByName('dominic').conversationsToDate < 1); }]
				),
				
				// quest helpers
				newNpcDialog(
						'You look like you have the spirit of a great baker inside you. '
						+ 'I smell yeast running through your veins. Here, take this breadknife. '
						+ 'I was going to throw it out anyway, but it can help you on your way to becoming a great baker.'
					, null,
					[function(){ return (isStructureOwnedBy('STOWN_PL_struct_DOMSBAKERY', 'dominic')
									&& isStructureOpen('STOWN_PL_struct_DOMSBAKERY')
									&& isCharacterOnQuest('COOKING_I')
									&& getInventoryItem('BREADKNIFE').quantity < 1
									&& getNpcByName('dominic').conversationsToDate > 1); }],
					function() {
							tryAddItemWithMessage('BREADKNIFE', 0, 1);
							addNpcDialogNarration(getNpcByName('dominic'), 'Come back once you have a cooking set and I\'ll show you an easy dough recipe.');
						}
				),
				newNpcDialog(
						'Looks like you\'ve got your cooking set together. Great! '
					, null,
					[function(){ return (isCharacterOnQuest('COOKING_II')
									&& getNpcByName('dominic').conversationsToday < 1); }],
					function() {
							if (testTime(30, false, false))
							{
								addNpcDialogNarration(getNpcByName('dominic'), 'I\'ll show you how to make a basic dough.');
								learnRecipe(characterState, 'DOUGH_BASIC', true);
								tryAddItemWithMessage('YEAST', 0, 1);
								tryAddItemWithMessage('FLOUR_WHEAT', 0, 1);
								addTime(30);
							}
							else
							{
								addNpcDialogNarration(getNpcByName('dominic'), 'It\'s late, but come back when you have more time. I\'ll show you how to make a basic dough.');
							}
						}
				),

				// work talk
				newNpcDialog('Hey welcome to my bakery. I haven\'t seen you around before.', null,
					[function(){ return (isStructureOwnedBy('STOWN_PL_struct_DOMSBAKERY', 'dominic')
									&& isStructureOpen('STOWN_PL_struct_DOMSBAKERY')
									&& getNpcByName('dominic').conversationsToDate < 1); }]
				),
				newNpcDialog([
						'Hey there, feel free to look around, I\'ve got lots of goodies.',
						'I specialize in sourdough breads. Why not take a loaf home?'
					], null,
					[function(){ return (isStructureOwnedBy('STOWN_PL_struct_DOMSBAKERY', 'dominic')
									&& isStructureOpen('STOWN_PL_struct_DOMSBAKERY')); }]
				)
			];
		}
	</script>
	<script> // NPC: Emma
		function emma()
		{
			var emma = newNpc('Emma', 'Brown', 25, 0,
				'A bubbly young lass who dresses in rustic western apparel.',
				newCharacterAppearance(heights.AVERAGE, bodyTypes.CURVY, hairColors.BLONDE, hairColors.BLONDE, hairStyles.PONYHIGH, eyeColors.BLUE, aesthetics.RUSTIC),
				[
					newNPCWorkSchedule('EMMARANCH_struct_EMMASSHOP'),
					newNpcSchedule('EMMAS_HOUSE', 'SLEEPING', [function(){ return !isStructureOpen('EMMARANCH_struct_EMMASSHOP'); }])
				]
			);
		}
	</script>
	<script> // NPC: Liam
		function liam()
		{
			var liam = newNpc('Liam', 'O\'Doyle', 26, 1,
				'A fiery ginger who likes to live life on the edge.',
				newCharacterAppearance(heights.AVERAGE, bodyTypes.AVERAGE, hairColors.RED, hairColors.RED, hairStyles.CREW, eyeColors.GREEN, aesthetics.CASUAL),
				[
					newNpcSchedule('STOWN_PL', 'CHILLING', [function(){ return timeBetween(6*60, 18*60); }])
				]);
		}
	</script>
	<script> // NPC: Luigi
		function luigi()
		{
			var luigi = newNpc('Luigi', 'D\'Graisse', 30, 1,
				'A loud, obnoxious, chef with a monstrous ego, but the skills to back it up.',
				newCharacterAppearance(heights.AVERAGE, bodyTypes.DADBOD, hairColors.BLONDE, hairColors.NBLONDE, hairStyles.CREW, eyeColors.BLUE, aesthetics.CASUAL),
				[
					newNPCWorkSchedule('STOWN_E_struct_GORDOSREST'),
					newNpcSchedule('STOWN_E', 'CHILLING', [function(){ return !isStructureOpen('STOWN_E_struct_GORDOSREST'); }])
				]);
			luigi.dialog = [
				newNpcDialog('Hey! Who are you? You never heard of Luigi D\'Graisse eh? If you want to taste some real food, come by my restaurant on the east side of town.', null,
					[function(){ return (isStructureOwnedBy('STOWN_E_struct_GORDOSREST', 'luigi')
									&& !isStructureOpen('STOWN_E_struct_GORDOSREST')
									&& getNpcByName('luigi').conversationsToDate < 1); }]
				),
				
				// quest helpers
				newNpcDialog(
						'I\'m too busy for you, go away!'
					, null,
					[function(){ return (isStructureOwnedBy('STOWN_E_struct_GORDOSREST', 'luigi')
									&& isStructureOpen('STOWN_E_struct_GORDOSREST')
									&& isCharacterOnQuest('COOKING_I')
									&& getInventoryItem('CHEFSKNIFE').quantity < 1
									&& getNpcByName('luigi').conversationsToDate > 1); }],
					function() {
							addAlertNarration('Luigi throws a chef\'s knife at you and it sticks into the wall.');
							tryAddItemWithMessage('CHEFSKNIFE', 0, 1);
							addNpcDialogNarration(getNpcByName('luigi'), 'Now scram!');
						}
				),

				// work talk
				newNpcDialog('You decided to experience culinary perfection, I see. Well sit down and order something!', null,
					[function(){ return (isStructureOwnedBy('STOWN_E_struct_GORDOSREST', 'luigi')
									&& isStructureOpen('STOWN_E_struct_GORDOSREST')
									&& getNpcByName('luigi').conversationsToDate < 1); }]
				)
			];
		}
	</script>
	<script> // NPC: Mateo
		function mateo()
		{
			var mateo = newNpc('Mateo', 'Gonzalez', 23, 1,
				'A quiet, hardworking fellow.',
				newCharacterAppearance(heights.AVERAGE, bodyTypes.AVERAGE, hairColors.BROWN, hairColors.BROWN, hairStyles.CREW, eyeColors.BROWN, aesthetics.RUSTIC),
				[
					newNpcSchedule('EMMARANCH_STAFF', 'SLEEPING', [function(){ return !timeBetween(5*60, 13*60); }]),
					newNpcSchedule('EMMARANCH', 'WORKING', [function(){ return !isDayOfWeek(['SA', 'SU']) && timeBetween(5*60, 13*60); }])
				],
				[bodyTypes.CURVY]);
		}
	</script>
	<script> // NPC: Olivia
		function olivia()
		{
			var olivia = newNpc('Olivia', 'Martin',
				22, 0, 'A short demure girl, with bangs and glasses. She\'d rather stay at home with her cat than go to parties.',
				newCharacterAppearance(heights.SHORT, bodyTypes.THIN, hairColors.BLONDE, hairColors.BLACK, hairStyles.BOB, eyeColors.BLUE, aesthetics.ALT),
				[
					// sleeping
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'SLEEPING', [function(){ return isDayOfWeek(['MO', 'TU', 'WE']) && !timeBetween(hm(7, 30), hm(21, 30)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'SLEEPING', [function(){ return isDayOfWeek(['TH']) && !timeBetween(hm(7, 30), hm(24)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'SLEEPING', [function(){ return isDayOfWeek(['FR', 'SA']) && !timeBetween(hm(9), hm(24)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'SLEEPING', [function(){ return isDayOfWeek(['SU']) && !timeBetween(hm(9), hm(21)); }]),
					
					// school days
					newNpcSchedule('STOWN_RES1', 'WALKING_E', [function(){ return isDayOfWeek(['MO', 'TU', 'WE', 'TH']) && timeBetween(hm(7, 31), hm(7, 40)); }]),
					newNpcSchedule('STOWN_N', 'WALKING_E', [function(){ return isDayOfWeek(['MO', 'TU', 'WE', 'TH']) && timeBetween(hm(7, 41), hm(7, 50)); }]),
					newNpcSchedule('STOWN_JC', 'STUDYING', [function(){ return isDayOfWeek(['MO', 'TU', 'WE', 'TH']) && timeBetween(hm(7, 51), hm(12, 0)); }]),
					newNpcSchedule('STOWN_JC', 'WALKING_W', [function(){ return isDayOfWeek(['MO', 'TU', 'WE', 'TH']) && timeBetween(hm(12, 1), hm(12, 10)); }]),
					
					// Monday after school
					newNpcSchedule('STOWN_N', 'WALKING_W', [function(){ return isDayOfWeek(['MO']) && timeBetween(hm(12, 11), hm(12, 20)); }]),
					newNpcSchedule('STOWN_RES1', 'HOME', [function(){ return isDayOfWeek(['MO']) && timeBetween(hm(12, 21), hm(12, 30)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'STUDYING', [function(){ return isDayOfWeek(['MO']) && timeBetween(hm(12, 31), hm(17)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'READING', [function(){ return isDayOfWeek(['MO']) && timeBetween(hm(17, 1), hm(20)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'CHILLING', [function(){ return isDayOfWeek(['MO']) && timeBetween(hm(20, 1), hm(21, 29)); }]),
					
					// work days after school
					newNpcSchedule('STOWN_N', 'WALKING_S', [function(){ return isDayOfWeek(['TU', 'WE', 'TH']) && timeBetween(hm(12, 11), hm(12, 20)); }]),
					newNpcSchedule('STOWN_PL', 'CHILLING', [function(){ return isDayOfWeek(['TU', 'WE', 'TH']) && timeBetween(hm(12, 21), hm(12, 45)); }]),
					newNpcSchedule('STOWN_PL_struct_DOMSBAKERY', 'CHILLING', [function(){ return isDayOfWeek(['TU', 'WE', 'TH']) && timeBetween(hm(12, 46), hm(12, 59)); }]),
					newNpcSchedule('STOWN_PL_struct_DOMSBAKERY', 'WORKING', [function(){ return isDayOfWeek(['TU', 'WE', 'TH']) && timeBetween(hm(13), hm(17)); }]),
					newNpcSchedule('STOWN_PL', 'WALKING_N', [function(){ return isDayOfWeek(['TU', 'WE', 'TH']) && timeBetween(hm(17, 1), hm(17, 10)); }]),
					newNpcSchedule('STOWN_N', 'WALKING_W', [function(){ return isDayOfWeek(['TU', 'WE', 'TH']) && timeBetween(hm(17, 11), hm(17, 20)); }]),
					newNpcSchedule('STOWN_RES1', 'HOME', [function(){ return isDayOfWeek(['TU', 'WE', 'TH']) && timeBetween(hm(17, 21), hm(17, 30)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'READING', [function(){ return isDayOfWeek(['TU', 'WE']) && timeBetween(hm(17, 31), hm(18)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'CHILLING', [function(){ return isDayOfWeek(['TU', 'WE']) && timeBetween(hm(18, 31), hm(21, 29)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'GAMING', [function(){ return isDayOfWeek(['TH']) && timeBetween(hm(17, 31), hm(23, 59)); }]),

					// weekends
					newNpcSchedule('STOWN_RES1', 'WALKING_E', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(9, 1), hm(9, 10)); }]),
					newNpcSchedule('STOWN_N', 'WALKING_S', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(9, 11), hm(9, 20)); }]),
					newNpcSchedule('STOWN_PL', 'CHILLING', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(9, 21), hm(9, 30)); }]),
					newNpcSchedule('STOWN_PL_struct_DOMSBAKERY', 'CHILLING', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(9, 31), hm(9, 40)); }]),
					newNpcSchedule('STOWN_PL_struct_DOMSBAKERY', 'READING', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(9, 41), hm(12)); }]),
					newNpcSchedule('STOWN_PL', 'WALKING_N', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(12, 1), hm(12, 10)); }]),
					newNpcSchedule('STOWN_N', 'WALKING_W', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(12, 11), hm(12, 20)); }]),
					newNpcSchedule('STOWN_RES1', 'HOME', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(12, 21), hm(12, 30)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'EATING', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(12, 31), hm(13)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'CHILLING', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(13, 1), hm(14)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'GAMING', [function(){ return isDayOfWeek(['FR', 'SA', 'SU']) && timeBetween(hm(14, 1), hm(17)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'READING', [function(){ return isDayOfWeek(['FR', 'SA']) && timeBetween(hm(17, 1), hm(23, 59)); }]),
					newNpcSchedule('STOWN_RES1_struct_MARTIN_HOUSE', 'READING', [function(){ return isDayOfWeek(['SU']) && timeBetween(hm(17, 1), hm(20, 59)); }]),
				],
				[aesthetics.ALT, bodyTypes.AVERAGE, eyeColors.GREEN]);
		}
	</script>
	<script> // areas
		var areas = [];
		// newArea(id, name, feats, exits, onEnter)
		var newGameAreas_Standard = [
			newArea(
				'HOMEPROP', 'Home Property',
				[
					newFeature('DEBRIS', 1),
					newFeature('DEBRIS', 2),
					newFeature('DEBRIS', 3),
					newFeature('DEBRIS', 4)
				],
				[
					newExit(directions.EAST, 'Old Farm rd', 'East on Old Farm road', 'OLDFARMRDW', 5, 0, null),
					newExit(directions.SOUTH, '%HOMEPROPMAME% Farm', 'South to %HOMEPROPMAME% Farm', 'HOMEFARM', 5, 0, function() {return !areaHasDebris(characterState.currentArea);})
				],
				'Welcome Home!'
			),
			newArea(
				'HOMEFARM', '%HOMEPROPMAME% Farm',
				[
					newFeature('DEBRIS', 3),
					newFeature('DEBRIS', 4),
					newFeature('WATER', 0, {waterType: waterTypes.POND, noDelete: true, description: 'A nice-sized pond. You remember swimming here as a child. Maybe there are still fish here.'}),
					newFeature('ITEM', 0, {displayName: 'Rusty Shovel', description: 'Someone left an old shovel here. It could come in handy.', actions: [ { actionFunction: function(){clickActionButton(this, pickupTool);}, text: 'Take', accessibleText: 'Take Rusty Shovel', attr: {tool: 'shovel', level: 1} }] })
				],
				[
					newExit(directions.NORTH, '%HOMEPROPMAME%', 'North to %HOMEPROPMAME%', 'HOMEPROP', 5, 0, null)
				],
				'' 
			),
			newArea(
				'OLDFARMRDW', 'Old Farm Rd West',
				[
					newFeature('FORAGE', 0, {...forageTypes.BLACKBERRY})
				],
				[
					newExit(directions.WEST, '%HOMEPROPMAME%', 'West to %HOMEPROPMAME%', 'HOMEPROP', 5, 0, null),
					newExit(directions.EAST, 'Old Farm rd', 'East on Old Farm road', 'OLDFARMRDE', 20, 0, null)
				],
				function(args) {
					var r = 'West end of Old Farm Road.';
					if (args !== null && args !== undefined)
					{
						switch (invDir(args.fromExit.direction))
						{
							case directions.WEST:
								r += ' Looks like it isn\'t well travelled.';
								break;
							case directions.EAST:
								r += ' You can see your family\'s old property from here.';
								break;
						}
					}
					return r;
				}
			),
			newArea(
				'OLDFARMRDE', 'Old Farm Rd East',
				[],
				[
					newExit(directions.WEST, 'Old Farm rd', 'West on Old Farm road', 'OLDFARMRDW', 20, 0, null),
					newExit(directions.EAST, 'Smalltown', 'East to Smalltown', 'STOWN_W', 5, 0, null),
					newExit(directions.SOUTH, 'Ranch Rd', 'South on Ranch Rd', 'RANCHRDN', 20, 0, null)
				],
				function(args) {
					var r = 'East end of Old Farm Road.';
					if (args !== null && args !== undefined)
					{
						switch (invDir(args.fromExit.direction))
						{
							case directions.WEST:
								r += ' You can see Smalltown at the end of the road.';
								break;
						}
					}
					return r;
				}
			),
			newArea(
				'RANCHRDN', 'Ranch rd North',
				[],
				[
					newExit(directions.NORTH, 'Old Farm rd', 'North to Old Farm Rd East', 'OLDFARMRDE', 20, 0, null),
					newExit(directions.SOUTH, 'Ranch Rd', 'South on Ranch Road', 'RANCHRDS', 20, 0, null)
				],
				'Ranch Road North'
			),
			newArea(
				'RANCHRDS', 'Ranch rd South',
				[],
				[
					newExit(directions.NORTH, 'Ranch Rd', 'North on Ranch Road', 'RANCHRDN', 20, 0, null),
					newExit(directions.WEST, 'Emma\'s Ranch', 'West to Emma\'s Ranch', 'EMMARANCH', 10, 0, null)
				],
				'Ranch Road South'
			),
			newArea(
				'EMMARANCH', 'Emma\'s Ranch',
				[],
				[
					newExit(directions.EAST, 'Ranch Rd', 'East to Ranch Road', 'RANCHRDS', 10, 0, null)
				],
				'Emma\'s Ranch, you can buy live stock and other ranching goods here.'
			),
			newArea(
				'STOWN_PL', 'Smalltown Plaza',
				[
					newFeature('SIGN', 0, {displayName: 'Plaza Guide', text: [UP_ARROW + ' North to Smalltown Jr. College', LEFT_ARROW + ' West to Old Farm Road', DOWN_ARROW + ' South to Shell Beach']}),
					newFeature('ITEM', 0, {displayName: 'Fountain', description: 'A large, marble fountain.',
						actions: [{ actionFunction: function(){
														if (testMoney(1, DEFAULT_MONEY_MESSAGE, true))
														{
															addAlertNarration('Ploop.');
															if (characterState.boon < 1) { addBoon(); }
														}
													},
							text: 'Toss a coin', accessibleText: 'Toss a coin into the fountain' }] })
				],
				[
					newExit(directions.NORTH, 'Smalltown North', 'North to Smalltown North', 'STOWN_N', 5, 0, null),
					newExit(directions.EAST, 'Smalltown East', 'East to Smalltown East', 'STOWN_E', 5, 0, null),
					newExit(directions.SOUTH, 'Smalltown South', 'South to Smalltown South', 'STOWN_S', 5, 0, null),
					newExit(directions.WEST, 'Smalltown West', 'West to Smalltown West', 'STOWN_W', 5, 0, null)
				],
				'Smalltown Plaza, the town center, where the action is. Check the Plaza Guide for directions.'
			),
			newArea(
				'STOWN_N', 'Smalltown North',
				[],
				[
					newExit(directions.EAST, 'Smalltown JC', 'East to Smalltown junior college', 'STOWN_JC', 5, 0, null),
					newExit(directions.SOUTH, 'Smalltown Plaza', 'South to Smalltown Plaza', 'STOWN_PL', 5, 0, null),
					newExit(directions.WEST, 'Cottage Rd', 'West on Cottage Road', 'STOWN_RES1', 5, 0, null)
				],
				'The northern edge of Smalltown'
			),
			newArea(
				'STOWN_E', 'Smalltown East',
				[],
				[
					newExit(directions.WEST, 'Smalltown Plaza', 'East to Smalltown Plaza', 'STOWN_PL', 5, 0, null)
				],
				'The eastern edge of Smalltown'
			),
			newArea(
				'STOWN_S', 'Smalltown South',
				[],
				[
					newExit(directions.NORTH, 'Smalltown Plaza', 'North to Smalltown Plaza', 'STOWN_PL', 5, 0, null),
					newExit(directions.SOUTH, 'Shell Beach', 'South to Shell Beach', 'STOWN_B', 5, 0, null)
				],
				function(args) {
					var r = 'The southern edge of Smalltown.';
					if (args !== null && args !== undefined)
					{
						switch (invDir(args.fromExit.direction))
						{
							case directions.NORTH:
								r += ' Shell Beach is to the south.';
								break;
						}
					}
					return r;
				}
			),
			newArea(
				'STOWN_W', 'Smalltown West',
				[],
				[
					newExit(directions.WEST, 'Old Farm rd', 'West to Old Farm road', 'OLDFARMRDE', 5, 0, null),
					newExit(directions.EAST, 'Smalltown Plaza', 'East to Smalltown Plaza', 'STOWN_PL', 5, 0, null)
				],
				'The western edge of Smalltown'
			),
			newArea(
				'STOWN_B', 'Shell Beach',
				[],
				[
					newExit(directions.NORTH, 'Smalltown South', 'North to Smalltown South', 'STOWN_S', 5, 0, null),
					newExit(directions.SOUTH, 'Pelican Pier', 'South to Pelican Pier', 'STOWN_D', 5, 0, null)
				],
				function(args) {
					var r = 'Shell Beach.';
					if (args !== null && args !== undefined)
					{
						switch (invDir(args.fromExit.direction))
						{
							case directions.NORTH:
								r += ' Lots of sand, waves and pelicans.';
								break;
							case directions.SOUTH:
								r += ' Smalltown South is to the north.';
								break;
						}
					}
					return r;
				}
			),
			newArea(
				'STOWN_D', 'Pelican Pier',
				[],
				[
					newExit(directions.NORTH, 'Shell Beach', 'North to Shell Beach', 'STOWN_B', 5, 0, null)
				],
				'Pelican Pier, where most of Smalltown\'s fisherman spend their mornings.'
			),
			newArea(
				'STOWN_JC', 'Smalltown Jr. College',
				[],
				[
					newExit(directions.WEST, 'Smalltown North', 'West to Smalltown North', 'STOWN_N', 5, 0, null)
				],
				'Smalltown junior college, where Smalltown\'s youth get ready for the working force.'
			),
			newArea(
				'STOWN_RES1', 'Cottage Rd',
				[],
				[
					newExit(directions.EAST, 'Smalltown North', 'East to Smalltown North', 'STOWN_N', 5, 0, null)
				],
				'Cottage Road, several Smalltown residents live on this street.'
			)
		];
		//"Fanciful Feldecarb Fountain flows full as fluttering fairies frolic fastidiously.  Flick a farthing?" 
		function setupNewGameStructures_Standard()
		{
			//function newStructure(areaId, type, area, owner, value, locked, amenities, options)
			newStructure('HOMESHACK', 'DWELL', 'HOMEPROP', null, 100, false,
						[
							newFeature('ITEM', 0, {canPickUp: true, canPurchase: false, itemStack: newItemStack('POT_OLD', 0, 1), onPickup: function(){ startQuest('COOKING_I'); }}),
							newFeature('CAMPFIRE', 0),
							newFeature('SLEEPINGBAG', 0)
						],
						{dwellingType: dwellingTypes.SHACK, noDelete: true,
							firstEnter: 'It looks like a squatter was living here. They left an old ratty sleeping bag and the remnants of a campfire.' }
			);
			newStructure('GARDENSHOP', 'SHOP', 'STOWN_PL', null, 1000000, null,
						[
							newFeature('ITEM', 0, {itemStack: newItemStack(items.SPINACH_SEED, 0, 1), canPickUp: false, canPurchase: true, conditions: function() {return (calendarState.season === seasons.SPRING);} })
						],
						{displayName: 'Avery\'s H&G',
							description: 'Avery\'s Home & Garden stocks seasonal seeds and general garden goods.' }
			);
			newStructure('DOMSBAKERY', 'SHOP', 'STOWN_PL', 'dominic', 1000000, null,
						[],
						{displayName: 'BPS Bakery',
							description: 'The Bread Poet\'s Society, bakery and coffee shop. Open mic on thursday nights.' }
			);
			newStructure('CLAYSDELI', 'SHOP', 'STOWN_PL', 'clayton', 1000000, null,
						[],
						{displayName: 'M&G Deli',
							description: 'Meat and Greet delicatessen. Get your meats and other foods here.' }
			).isLocked = function() { return !between(calendarState.minutes, hm(7, 59), hm(16), false); };
			newStructure('GORDOSREST', 'SHOP', 'STOWN_E', 'luigi', 1000000, null,
						[],
						{displayName: 'D\'Graisse\'s',
							description: 'Smalltowns own fine dining establishment. Very good reviews online.' }
			);
			newStructure('EMMASSHOP', 'SHOP', 'EMMARANCH', null, 2000000, null,
						[],
						{displayName: 'Emma\'s Feed',
							description: 'Emma\'s Feed carries livestock, feed and ranching goods.' }
			).isLocked = function() { return !between(calendarState.minutes, hm(7, 59), hm(16), false); };
			newStructure('EMMAS_HOUSE', 'DWELL', 'EMMARANCH', null, 1000000, true,
						[],
						{dwellingType: dwellingTypes.HOUSE, noDelete: false, description: 'Emma\'s house.' }
			);
			newStructure('EMMARANCH_STAFF', 'DWELL', 'EMMARANCH', null, 10000, true,
						[],
						{dwellingType: dwellingTypes.BUNG, noDelete: false, description: 'On-site living for ranch hands.' }
			);
			newStructure('MARTIN_HOUSE', 'DWELL', 'STOWN_RES1', null, 250000, true,
						[],
						{dwellingType: dwellingTypes.COTTAGE, noDelete: false, description: 'The Martin Residence.' }
			);
		}
	</script>
	<script> // character functions
		function addStamina(n)
		{
			characterState.stamina = clamp(characterState.stamina + n, 0, characterState.maxStamina);
			updateDisplay();
			if (characterState.stamina == 0)
			{
				addNarrationMessage('You are out of stamina, you should head to bed.');
			}
		}
		function addMoney(n)
		{
			characterState.money = clamp(characterState.money + n, 0, 999999999);
			updateDisplay();
			if (characterState.money == 0)
			{
				addNarrationMessage('You are out of money.');
			}
		}
		function addBoon()
		{
			characterState.boon++;
		}
		var DEFAULT_STAMINA_MESSAGE = 'You don\'t have the energy for this.';
		function testStamina(cost, message, update)
		{
			if (characterState.stamina >= cost)
			{
				if (update) { addStamina(-cost); } 
				return true;
			}
			if (message !== null)
			{
				addNarrationMessage(message);
			}
			return false;
		}
		function testTime(cost, passout, update)
		{
			if (calendarState.minutes + cost < getPassOutTime())
			{
				if (update) { addTime(cost); }
				return true;
			}
			if (passout)
			{
				passOut();
			}
			return false;
		}
		var DEFAULT_MONEY_MESSAGE = 'You don\'t have the money.';
		function testMoney(cost, message, update)
		{
			if (characterState.money >= cost)
			{
				if (update) { addMoney(-cost); } 
				return true;
			}
			if (message !== null)
			{
				addNarrationMessage(message);
			}
			return false;
		}
		var DEFAULT_ADD_INVENTORY_MESSAGE = 'You can\'t hold any more of this item.';
		function tryAddInventory(item, level, quantity, message)
		{
			var it = item;
			if (typeof(it) !== 'object')
			{
				it = items[it];
			}
			var stack = getInventoryItem(item, level);
			if (stack.quantity + quantity <= it.maxStack)
			{
				addItemToInventory(item, level, quantity);
				return true;
			}
			if (message)
			{
				addAlertNarration(DEFAULT_ADD_INVENTORY_MESSAGE);
			}
			return false;
		}
		function tryAddItemWithMessage(item, level, quantity)
		{
			var success = tryAddInventory(item, level, quantity, true);
			if (success)
			{
				var i = items[item];
				addAlertNarration(ucaseName(getFuncOrVar(i.displayName)) + ' ' + ((quantity > 1) ? 'x' + quantity : '') + 'added to your inventory.');
				checkQuestTriggers(characterState, questTriggers.GAININVENTORYITEM);
			}
			return success;
		}
		function tryRemoveInventory(item, level, quantity, message)
		{
			var item = getInventoryItem(item, level);
			var name = items[item.item].displayName;
			if (item.quantity < quantity)
			{
				if (message) { addAlertNarration('Tried to remove ' + ucaseName(name) + ' ' + ((quantity > 1) ? 'x' + quantity + ' ' : '') + ' from your inventory, but couldn\'t.'); }
				return false;
			}
			else
			{
				if (message) { addAlertNarration(ucaseName(name) + ' ' + ((quantity > 1) ? 'x' + quantity + ' ' : '') + ' removed from your inventory.'); }
				item.quantity -= quantity;
			}
			var i = getInventoryItemIndex(item, level);
			characterState[i] = item;
			return true;
		}
		function countInventoryItem(item, level = 0)
		{
			var r = 0;
			var it = getItem(item);
			for (var i=0;i<characterState.inventory.length;i++)
			{
				if (characterState.inventory[i].item === it.id && characterState.inventory[i].level >= level)
				{
					r += characterState.inventory[i].quantity;
				}
			}
			return r;
		}
		function getInventoryItemIndex(item, level = 0)
		{
			for (var i=0;i<characterState.inventory.length;i++)
			{
				var csi = characterState.inventory[i];
				if (csi.item === item && csi.level == level && csi.quantity > 0)
				{
					return i;
				}
			}
			return -1;
		}
		function getInventoryItem(item, level = 0)
		{
			var it = item;
			if (typeof(it) === 'object')
			{
				it = items[it].item;
			}
			var i = getInventoryItemIndex(it, level);
			if (i < 0) { return newItemStack(it, 0, 0); }
			return characterState.inventory[i];
		}
		function getAllInvetoryItemsAtLevel(item, level = 0)
		{
			var r = [];
			for (var i=0;i<characterState.inventory.length;i++)
			{
				var csi = characterState.inventory[i];
				if (csi.item === item && csi.level >= level && csi.quantity > 0)
				{
					r.push(characterState.inventory[i]);
				}
			}
			return r;
		}
		function addItemToInventory(item, level, quantity)
		{
			var q = quantity;
			for (var i=0;i<characterState.inventory.length;i++)
			{
				if (characterState.inventory[i].item === item && characterState.inventory[i].level == level)
				{
					characterState.inventory[i].quantity += quantity;
					q = characterState.inventory[i].quantity;
				}
			}
			characterState.inventory.push(newItemStack(item, level, quantity));
			
			return q;
		}
		function updateInventoryTable()
		{
			var x = g('inventoryTableBody');
			x.innerHTML = '';
			
			for (var i=0;i<characterState.inventory.length;i++)
			{
				var stack = characterState.inventory[i];
				var item = items[stack.item];
				if (stack.quantity > 0)
				{
					var row = ce('tr');
					var nameTd = ce('td');
					var actionTd = ce('td');
					
					if (stack.quantity > 1)
					{
						nameTd.innerHTML = ucaseName(item.pluralName) + ' x' + stack.quantity;
					}
					else
					{
						nameTd.innerHTML = ucaseName(item.displayName);
					}
					if (stack.level > 0)
					{
						nameTd.appendChild(renderStars(stack.level, true));
					}	

					actionTd.appendChild(makeItemInspectbutton(item));

					row.appendChild(nameTd);
					row.appendChild(actionTd);
					x.appendChild(row);
				}
			}
		}
		function makeItemInspectbutton(item)
		{
			return makeButton('ochreButton', function(){inspectItem(this);}, INSPECT_ICON, 'Inspect ' + item.displayName, {itemid: item.id});
		}
		function inspectItem(itemButton)
		{
			if (items.hasOwnProperty(itemButton.getAttribute('data-itemid')) && items[itemButton.getAttribute('data-itemid')].hasOwnProperty('description'))
			{
				var item = items[itemButton.getAttribute('data-itemid')];
				addAlertNarration(item.description);
			}
			else
			{
				addAlertNarration('No description available.');
			}
		}
		function characterKnowsRecipe(character, recipe)
		{
			var rec = getRecipe(recipe);
			for (var i=0;i<character.knownRecipes.length;i++)
			{
				if (character.knownRecipes[i] == rec.id) { return true; }
			}
			return false;
		}
		function characterHasCookedRecipe(character, recipe)
		{
			var rec = getRecipe(recipe);
			for (var key in character.cookedRecipes)
			{
				if (key == rec.id) { return character.cookedRecipes[key]; }
			}
			return 0;
		}
		function learnRecipe(character, recipe, message)
		{
			if (!characterKnowsRecipe(character, recipe))
			{
				var rec = getRecipe(recipe);
				character.knownRecipes.push(rec.id);
				if (message)
				{
					addAlertNarration('You\'ve learned a recipe for: ' + rec.displayName + '.');
				}
				checkQuestTriggers(character, questTriggers.LEARNRECIPE);
			}
		}
		function hasIngredientsForRecipe(recipe)
		{
			for (var i=0;i<recipe.ingredients.length;i++)
			{
				if (getInventoryItem(recipe.ingredients[i].item, null).quantity < 1) { return false; }
			}
			return true;
		}
		
		function tryPurchaseItem(button)
		{
			var feat = features[parseInt(button.getAttribute('data-feature'))];
			var quantity = parseInt(button.getAttribute('data-purchaseQuantity'));
			var price = feat.itemStack.item.value * quantity;
			if (testMoney(price, DEFAULT_MONEY_MESSAGE, true))
			{
				tryAddInventory(feat.itemStack.item, feat.itemStack.level, quantity, true);
			}
		}
		function getItem(item)
		{
			var itemId = item;
			if (typeof(item) === 'object')
			{
				if (item.hasOwnProperty('maxStack')) { return item; }
				if ('tagName' in item)
				{
					itemId = item.getAttribute('data-itemid');
				}
			}
			for (var key in items)
			{
				if (key == itemId) { return items[key]; }
			}
			return null;
		}
		function clickTakeItemButton(itemButton)
		{
			tryPickupItem(itemButton.getAttribute('data-itemid'),
				itemButton.getAttribute('data-itemlevel'),
				itemButton.getAttribute('data-itemquantity'),
				itemButton.getAttribute('data-area'),
				itemButton.getAttribute('data-feature'));
		}
		function tryPickupItem(item, level, quantity, areaId, featureId)
		{
			if (tryAddItemWithMessage(item, level, quantity))
			{
				var feat = getFeature(featureId);
				if (feat.hasOwnProperty('onPickup'))
				{
					feat.onPickup();
				}
				deleteFeature(areaId, featureId);
				updateDisplay();
			}
		}
	</script>
	<script> // quest functions
		function setupQuests_Standard()
		{
			// newQuest(id, name, description, rewards, triggers, conditions, onComplete)
			newQuest('COOKING_I', 'Commence Cooking I',
					'Collect a breadknife, a cleaver and a chef\'s knife to make a set.',
					'Beginner Knife Set',
					[questTriggers.GAININVENTORYITEM],
					[function(cs) {
							return (getInventoryItem('BREADKNIFE').quantity > 0
								&& getInventoryItem('CLEAVER').quantity > 0
								&& getInventoryItem('CHEFSKNIFE').quantity > 0);
						}],
					function(cs) {
							tryRemoveInventory('BREADKNIFE', 0, 1, true);
							tryRemoveInventory('CLEAVER', 0, 1, true);
							tryRemoveInventory('CHEFSKNIFE', 0, 1, true);
							tryRemoveInventory('POT_OLD', 0, 1, true);
							upgradeTool(cs, 'cookingSet', 1);
							addAlertNarration('Cooking Set added to tools.')
							addAlertNarration('You completed the Cooking Set. Now that you\'ve got it, maybe some of the locals will share some of their recipes.');
							startQuest('COOKING_II');
						});
			newQuest('COOKING_II', 'Commence Cooking II',
					'Talk to the local foodies and learn a few techniques.',
					'Level 1 Cooking Skill',
					[questTriggers.LEARNRECIPE],
					[function(cs) {
							return (characterKnowsRecipe(cs, 'KABOB_STEAK')
								&& characterKnowsRecipe(cs, 'DOUGH_BASIC'));
						}],
					function(cs) {
							addAlertNarration('You\'ve got the tools and a couple basic recipes, now you can begin your cooking career.')
							upgradeSkill(cs, 'cooking', 1, true);
							startQuest('COOKING_III');
						});
			newQuest('COOKING_III', 'Commence Cooking III',
					'Make a basic dough and cook a steak kabob.',
					'New Recipes',
					[questTriggers.COOKRECIPE],
					[function(cs) {
							return (characterHasCookedRecipe(cs, 'KABOB_STEAK') > 0
								&& characterHasCookedRecipe(cs, 'DOUGH_BASIC') > 0);
						}],
					function(cs) {
							addAlertNarration('By tinkering around with your cooking techniques, you\'ve unlocked a few recipes. Now you\'re on your own to learn the ways of the chef.')
							learnRecipe(cs, 'BREAD_CAMPFIRE', true);
							learnRecipe(cs, 'BURGER_RUSTIC', true);
							learnRecipe(cs, 'MARSHMALLOW_ROASTED', true);
						});
		}

		function populateJournalTab()
		{
			var xAct = g('activeQuestsTableBody');
			var xCom = g('completedQuestsTableBody');
			xAct.innerHTML = '';
			xCom.innerHTML = '';
			var hasActive = false;
			var hasCompleted = false;
			for (var i=0;i<characterState.quests.length;i++)
			{
				if (characterState.quests[i].status != questStatuses.NOTSTARTED)
				{
					var row = ce('tr');
					var nameTd = ce('td');
					var actionTd = ce('td');
					nameTd.innerHTML = characterState.quests[i].name;
					var status = characterState.quests[i].status;
					if (status == questStatuses.AWARDED)
					{
						actionTd.appendChild(makeButton('greenButton', function(){collectQuestRewards(this);}, 'Reward', 'Collect Rewards for ' + characterState.quests[i].name, {questid: characterState.quests[i].id}));
					}
					actionTd.appendChild(makeButton('ochreButton', function(){inspectQuest(this);}, INSPECT_ICON, 'Inspect ' + characterState.quests[i].name, {questid: characterState.quests[i].id}));
					row.appendChild(nameTd);
					row.appendChild(actionTd);
					if (status == questStatuses.ACTIVE || status == questStatuses.AWARDED)
					{
						xAct.appendChild(row);
						hasActive = true;
					}
					if (status == questStatuses.COMPLETED)
					{
						xCom.appendChild(row);
						hasCompleted = true;
					}
				}
			}
			if (hasActive)
			{
				g('activeQuestsBox').style.display = 'block';
				g('noActiveQuestsBox').style.display = 'none';
			}
			else
			{
				g('activeQuestsBox').style.display = 'none';
				g('noActiveQuestsBox').style.display = 'block';
			}
			if (hasCompleted)
			{
				g('completedQuestsBox').style.display = 'block';
				g('noCompletedQuestsBox').style.display = 'none';
			}
			else
			{
				g('completedQuestsBox').style.display = 'none';
				g('noCompletedQuestsBox').style.display = 'block';
			}
		}
		
		function getQuest(quest)
		{
			var questId = quest;
			if (typeof(quest) === 'object')
			{
				if (quest.hasOwnProperty('onComplete')) { return quest; }
				if ('tagName' in quest)
				{
					questId = quest.getAttribute('data-questid');
				}
			}

			for (var i=0;i<quests.length;i++)
			{
				if (quests[i].id == questId)
				{
					return quests[i];
				}
			}
			return null;
		}
		function startQuest(questId, message = true)
		{
			var q = getQuest(questId);
			if (q !== null)
			{
				if (getCharacterQuestStatus(questId) == questStatuses.NOTSTARTED)
				{
					characterState.quests.push(q);
					q.status = questStatuses.ACTIVE;
					if (message)
					{
						addAlertNarration('Quest added to your journal: ' + q.name);
					}
				}
			}
			else
			{
				if (message) { addAlertNarration('There was a problem starting this quest.'); }
			}
		}
		function getCharacterQuestStatus(quest)
		{
			var questId = getQuest(quest).id;
			if (questId !== null)
			{
				for (var i=0;i<characterState.quests.length;i++)
				{
					if (characterState.quests[i].id == questId)
					{
						return characterState.quests[i].status;
					}
				}
			}
			return questStatuses.NOTSTARTED;
		}
		
		function isCharacterOnQuest(quest)
		{
			return (getCharacterQuestStatus(quest) == questStatuses.ACTIVE);
		}
		function hasCharacterFinishedQuest(quest)
		{
			return (getCharacterQuestStatus(quest) == questStatuses.COMPLETED);
		}
		
		function checkQuestTriggers(character, trigger)
		{
			for (var i=0;i<character.quests.length;i++)
			{
				var q = character.quests[i];
				if (q.status == questStatuses.ACTIVE)
				{
					if (q.triggers.includes(trigger))
					{
						if (testConditions(character, q.conditions))
						{
							addAlertNarration('You completed the quest: <i>"' + q.name + '"</i>. Check your journal tab to collect rewards.');
							q.status = questStatuses.AWARDED;
							updateDisplay();
						}
					}
				}
			}
		}
		function collectQuestRewards(quest)
		{
			var q = getQuest(quest);
			if (q !== null)
			{
				if (getCharacterQuestStatus(q) == questStatuses.AWARDED)
				{
					q.onComplete(characterState);
					q.status = questStatuses.COMPLETED;
					updateDisplay();
				}
			}
		}
	</script>
	<script> // npc functions
		function getNpcByName(name)
		{
			for (var i=0;i<npcs.length;i++)
			{
				if (npcs[i].firstName.toLowerCase().substring(0, name.length) == name.toLowerCase())
				{
					return npcs[i];
				}
			}
			return null;
		}
		function getPresentNpcs(area)
		{
			var n = [];
			var a = getArea(area);
			for (var i=0;i<npcs.length;i++)
			{
				var scheds = getNpcSchedulesForArea(npcs[i], area);
				for (var s=0;s<scheds.length;s++)
				{
					if (testConditions(characterState, scheds[s].conditions))
					{
						npcs[i].currentActivity = scheds[s].activity;
						n.push(npcs[i]);
					}
				}
			}
			return n;
		}
		function getNpcSchedulesForArea(npc, area)
		{
			var a = getArea((area == null || area == undefined) ? characterState.currentArea : area);
			var r = [];
			if (npc.hasOwnProperty('schedule') && npc.schedule !== null && npc.schedule !== undefined)
			{
				for (var i=0;i<npc.schedule.length;i++)
				{
					if (npc.schedule[i].area == a.id)
					{
						r.push(npc.schedule[i]);
					}
				}
			}
			return r;
		}
		function getNpcAttraction(npc, app)
		{
			var r = 0;
			var n = npcs[npc];
			r += (n.personalPreferences.includes(app.bodyType)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.aesthetic)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.eyes)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.currentHairColor)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.hairStyle)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.height)) ? 1 : 0;
			r += (n.personalPreferences.includes(attractors.DYED_HAIR) && app.currentHair != app.naturalHairColor) ? 1 : 0;
			
			return r;
		}
		function whereIsNpc(name)
		{
			var n = getNpcByName(name);
			if (n !== null)
			{
				for (var s=0;s<n.schedule.length;s++)
				{
					for (var c=0;c<n.schedule[s].conditions.length;c++)
					{
						if (testConditions(chracterState, n.schedule[s].conditions[c])) { return n.schedule[s].area; }
					}
				}
			}
			return null;
		}
		function talkToNpc(npc)
		{
			var n = npc;
			if ('tagName' in npc)
			{
				n = npcs[npc.getAttribute('data-npcid')];
			}
			if (n !== null && n !== undefined)
			{
				var npcd = getNpcDialog(n);
				if (npcd !== null)
				{
					addTime(5);
					addNpcDialogNarration(n, npcd.text);
					if (npcd.after !== null && npcd.after !== undefined)
					{
						npcd.after();
					}
				}
				else
				{
					addAlertNarration(n.firstName + ' ' + getRandomArrayValue([
							'doesn\'t seem to want to talk at the moment.',
							'doesn\'t have anything to say right now.',
							'seems to be lost in thought.'
						]));
				}
				n.conversationsToDate++;
				n.conversationsToday++;
			}
		}
		function getNpcDialog(n)
		{
			for (var d=0;d<n.dialog.length;d++)
			{
				for (var c=0;c<n.dialog[d].conditions.length;c++)
				{
					if (testConditions(characterState, n.dialog[d].conditions[c]))
					{
						return n.dialog[d];
					}
				}
			}
			return null;
		}
	</script>
	<script> // action button functions
		function clickActionButton(button, action)
		{
			action(button);
			updateDisplay();
		}
		function inspect(obj)
		{
			if (obj.hasOwnProperty('description'))
			{
				addAlertNarration(getFuncOrVar(obj.description, obj));
			}
			else
			{
				addAlertNarration('No description available.');
			}
		}
		function inspectQuest(quest)
		{
			var q = quest;
			if ('tagName' in quest)
			{
				q = getQuest(quest.getAttribute('data-questid'));
			}
			addSignTextNarration(['<b>Quest: ' + q.name + '</b>' + '%LINE_HOR%', '<b>Objectives:</b> ' + q.description + '%LINE_HOR%', '<b>Rewards</b>: ' + q.rewards]);
		}
		function inspectStructure(struct)
		{
			var s = struct;
			if ('tagName' in struct)
			{
				s = structures[struct.getAttribute('data-structureid')];
			}
			if (s.type == 'DWELL' && s.type.hasOwnProperty('description'))
			{
				inspect(s.dwellingType);
			}
			else
			{
				inspect(s);
			}
		}
		function inspectNpc(npc)
		{
			var n = npc;
			if ('tagName' in npc)
			{
				n = npcs[npc.getAttribute('data-npcid')];
			}
			var t = [];
			t.push(n.firstName + ' ' + n.lastName + renderHearts(n.characterRelationship.level).outerHTML + '%LINE_HOR%' + '<i>' + n.description + '</i><br />');
			var app = n.appearance;
			t.push(n.age + ' year old ' + sexes[n.sex]);
			t.push('<b>Height:</b> ' + app.height.displayName);
			t.push('<b>Body Type:</b> ' + app.bodyType.displayName);
			t.push('<b>Hair:</b> ' + app.currentHairColor.displayName + ' ' + app.hairStyle.displayName);
			t.push('<b>Eyes:</b> ' + app.eyes.displayName);
			t.push('<b>Aesthetic:</b> ' + app.aesthetic.displayName);
			addSignTextNarration(t);
		}
		function inspectFeature(featureButton)
		{
			var f = getFeature(featureButton.getAttribute('data-featureid'));
			if (f.type == 'SIGN' && f.hasOwnProperty('text'))
			{
				addAlertNarration('This sign reads:');
				var t = '';
				if (Array.isArray(f.text))
				{
					var ts = [];
					for (var i=0;i<f.text.length;i++)
					{
						ts.push(getFuncOrVar(f.text[i]));
					}
					t = ts.join('<br />');
				}
				else
				{
					t = getFuncOrVar(f.text);
				}
				addSignTextNarration(t);
			}
			else if (f.type == 'ITEM' && f.hasOwnProperty('itemStack'))
			{
				inspect(f.itemStack.item);
			}
			else
			{
				inspect(f);
			}
		}
		function clickClearDebrisButton(button)
		{
			var f = getFeature(button.getAttribute('data-feature'));
			tryClearDebris(f.level, 30*Math.pow(2, f.level-1), button.getAttribute('data-area'), button.getAttribute('data-feature'));
		}
		function clickNavButton(button)
		{	
			tryTravel(getArea(button.getAttribute('data-area')).exits[button.getAttribute('data-exit')]);
		}
		function clickFishButton(button)
		{
			tryFishingInWater(button.getAttribute('data-area'), button.getAttribute('data-feature'));
		}
		function clickForageButton(button)
		{
			var id = parseInt(button.getAttribute('data-feature'));
			var feat = getFeature(id);
			var q = rint(feat.maxQuantity - feat.minQuantity + 1) + feat.minQuantity;
			if (!worldState.foragedThisWeek.includes(id) && testConditions(characterState, feat.conditions))
			{
				if (tryAddInventory(feat.item, feat.level, getForagedItemQuantity(q), true))
				{
					if (getSkillLevel(characterState, 'foraging') > 0 && roll(getForagedBonusChance()))
					{
						if (tryAddInventory(feat.item, feat.level + 1, getForagedBonusQuantity(), false))
						{
							q += getForagedBonusQuantity();
						}
					}
					worldState.foragedThisWeek.push(id);
					updateDisplay();
					addAlertNarration('Added ' + q + ' ' + getPluralizedItemName(feat.item, q) + ' to your inventory.');
				}
			}
		}
	</script>
	<script> // game setup functions
		function startNewGame()
		{
			setSubcontent('gameBox', 'startNewGame');
			clearNarrationBox();
			addNarrationMessage('Welcome to Smalltown.');
			addNarrationMessage('You\'ve inherrited a large property from your recently deceased relative and decided to uproot your whole life to live here.');
			addNarrationMessage('Tell me a little about yourself:');
		}
		function continueGame()
		{
			setSubcontent('gameBox', 'continueGame');
		}
		function updateCharacterName(name)
		{
			characterState.name = name;
		}
		function setSubcontent(container, content)
		{
			var con = g(container);
			con.setAttribute('data-prevSubcontent', con.getAttribute('data-subcontent'));
			con.setAttribute('data-subcontent', content);
			var subcons = con.getElementsByClassName(con.getAttribute('data-subcontent-type'));
			for (var i=0;i<subcons.length;i++)
			{
				subcons[i].style.display = 'none';
			}
			var currentContent = g(con.getAttribute('data-subcontent-type') + '-' + content);
			currentContent.style.display = con.getAttribute('data-subcontent-default');
			fixButtonTextWidths(currentContent);
		}
		function getSubcontent(container)
		{
			return g(container).getAttribute('data-subcontent');
		}
		function selectTab(container, content, tabClass, selectedTab)
		{
			setSubcontent(container, content);
			var tabs = document.getElementsByClassName(tabClass);
			for (var i=0;i<tabs.length;i++)
			{
				tabs[i].setAttribute('data-selected', 'false');
			}
			selectedTab.setAttribute('data-selected', 'true');
			selectedTabs[container] = content;
			updateDisplay();
		}
	</script>
	<script> // property functions
		function updatePropertyName(index, prop)
		{
			if (characterState.ownedAreas.includes(index))
			{
				getArea(index).name = prop;
			}
		}
	</script>
	<script> // game save functions
		function getGameSaves()
		{
			return null;
		}
		function loadGame(game)
		{
			if (game === null)
			{
				var name = g('yourNameInput').value;
				var prop = g('propNameInput').value;
				if (name != '' && prop != '')
				{
					clearNarrationBox();
					newGame(name, prop);
				}
			}
		}
		function newGame(name, prop)
		{
			areas = [...newGameAreas_Standard];
			setupNewGameStructures_Standard();
			setupQuests_Standard();
			characterState = newCharacterState_Standard();
			calendarState = newCalendarState_Standard();
			setGamePreferences(newGamePreferences_Standard());
			newGameNpcs_Standard();
			worldState = newWorldState();
			updateCharacterName(name);
			updatePropertyName('HOMEPROP', prop);
			characterState.appearance = newCharacterAppearance(
				heights[g('heightInput').value],
				bodyTypes[g('bodyTypeInput').value],
				hairColors[g('hairInput').value],
				hairColors[g('hairInput').value],
				hairStyles[g('hairStyleInput').value],
				eyeColors[g('eyeInput').value],
				aesthetics[g('aestheticInput').value]
			);
			if (g('sexInputMale').checked) { characterState.sex = 1; }
			else { characterState.sex = 0; }
			setSubcontent('gameBox', 'main');
			setSubcontent('viewBox', 'currentArea');
			setCurrentArea('HOMEPROP', null);
			selectTab('tabBox', 'area', 'maintabs', g('mainTab_Area'));
			gameHasStarted = true;
		}
		function setGamePreferences(pref)
		{
			gamePreferences = pref;
			g('pref_areaTabOnTravel_yes').checked = pref.areaTabOnTravel;
			g('pref_areaTabOnTravel_no').checked = !pref.areaTabOnTravel;
		}
		function passOut()
		{
			clearNarrationBox();
			addNarrationMessage('You passed out from exhaustion.');
			addNarrationMessage('Thankfully a kind citizen found you and took you home.');
			if (rint(50))
			{
				characterState.money = Math.max(0, Math.round(characterState.money / 2));
				addNarrationMessage('But not before someone went through your pockets and robbed you.');
			}
		}
	</script>
	<script> // misc functions
		function clearNarrationBox()
		{
			var nar = g('narrationBox');
			nar.innerHTML = '';
		}
		function appendNarrationBox(message, className)
		{
			var nar = g('narrationBox');
			var p = ce('p');
			if (Array.isArray(message))
			{
				var t = [];
				for (var i=0;i<message.length;i++)
				{
					t.push(handleWildcards(message[i]))
				}
				p.innerHTML = t.join('<br />');
			}
			else { p.innerHTML = handleWildcards(message); }
			p.className = className;
			nar.appendChild(p);
		}
		function addNarrationMessage(message)
		{
			appendNarrationBox(message, 'narrationMessage');
		}
		function scrollNarrationToBottom()
		{
			var nar = g('narrationBox');
			nar.scrollTop = nar.scrollHeight;
		}
		function addAlertNarration(message)
		{
			addNarrationMessage(message);
			scrollNarrationToBottom();
		}
		function addSignTextNarration(message)
		{
			appendNarrationBox(message, 'signTextNarrationMessage');
			scrollNarrationToBottom();
		}
		function addNpcDialogNarration(npc, message)
		{
			var n = npc;
			if (typeof(n) !== 'object')
			{
				n = getNpcByName(npc);
			}
			var text = ['<b>' + n.firstName + ' says:</b>'];
			if (Array.isArray(message))
			{
				text.push(...message);
			}
			else
			{
				text.push(message);
			}
			addSignTextNarration(text);
		}
		function handleWildcards(text)
		{
			var r = text;
			if (gameHasStarted)
			{
				r = swapWildCard_Property(getArea('HOMEPROP'), r, '%HOMEPROPMAME%', getArea('HOMEPROP').name);
				r = swapWildCard_Property(characterState.skills, r, '%EARLYBIRDMIN%', getEarlyBirdMinutes());
				r = swapWildCard_Property(characterState.skills, r, '%NIGHTOWLMIN%', getNightOwlMinutes());
			}
			r = r.replace('%LINE_HOR%', '<hr />');
			return r;
		}
		function swapWildCard_Property(testProp, text, wildcard, value)
		{
			return swapWildCard_Condition((testProp !== null && testProp != undefined), text, wildcard, value);
		}
		function swapWildCard_Condition(condition, text, wildcard, value)
		{
			if (condition) { return text.replace(wildcard, value); }
			return text;
		}
		function makeButton(className, action, buttonText, accessibleText, attr)
		{
			var b = ce('button');
			b.className = className;
			b.onclick = action;
			if (accessibleText !== null)
			{
				b.setAttribute('aria-label', handleWildcards(accessibleText));
				b.setAttribute('title', handleWildcards(accessibleText));
			}
			b.innerHTML = handleWildcards(buttonText);
			
			if (attr != null)
			{
				for (var key in attr)
				{
					b.setAttribute('data-' + key, attr[key]);
				}
			}
			return b;
		}
		function testConditions(character, conditions)
		{
			if (conditions === null || conditions === undefined)
			{
				return true;
			}
			if (Array.isArray(conditions))
			{
				for (var i=0;i<conditions.length;i++)
				{
					if (conditions[i](character) == true) { return true; }
				}
			}
			if (typeof(conditions) === 'function')
			{
				return conditions(character);
			}
			return false;
		}
	</script>
	<script> // display functions
		function updateDisplay()
		{
			updateCalendar();
			updateStamina();
			updateMoney();
			updateNavigationButtons();
			populateTabBox();
		}
		function updateCalendar()
		{
			if (calendarState != null)
			{
				g('currentDayOfWeek').innerHTML = getDayOfWeek().displayName;
				g('currentSeason').innerHTML = calendarState.season.displayName;
				g('currentSeasonDay').innerHTML = ord(calendarState.dayOfSeason + 1);
				updateClock();
			}
		}
		function getDayOfWeek(dayOfSeason)
		{
			if (dayOfSeason !== null && dayOfSeason !== undefined)
			{
				weekDays[dayOfSeason % 7];
			}
			else
			{
				return weekDays[calendarState.dayOfSeason % 7];
			}
		}
		function updateClock()
		{
			if (calendarState != null)
			{
				var ampm = 'AM';
				var hours = Math.floor(calendarState.minutes / 60);
				if (hours > 5 && hours < 18)
				{
					g('timeOfDayEmoji').innerHTML = SUN_ICON;
					g('timeOfDayEmoji').className = 'sunEmoji';
				}
				else
				{
					g('timeOfDayEmoji').innerHTML = MOON_ICON;
					g('timeOfDayEmoji').className = 'moonEmoji';
				}
				if (hours >= 12)
				{
					if (hours > 12)
					{
						hours -= 12;
					}
					ampm = 'PM';
				}
				var minutes = calendarState.minutes % 60;
				
				g('timeOfDayHour').innerHTML = hours;
				var minstr = '00' + minutes.toString();
				g('timeOfDayMinutes').innerHTML = minstr.substring(minstr.length - 2);
				g('timeOfDayAmPm').innerHTML = ampm;
			}
		}
		function updateStamina()
		{
			g('currentStaminaPercent').innerHTML = Math.round(characterState.stamina / characterState.maxStamina * 100);
		}
		function updateMoney()
		{
			g('currentMoney').innerHTML = characterState.money.toLocaleString();
		}
		function updateNavigationButtons()
		{
			var a = getArea(characterState.currentArea);
			
			var ntxt = g('northNavButtonText'); ntxt.innerHTML = 'No path';
			var etxt = g('eastNavButtonText'); etxt.innerHTML = 'No path';
			var stxt = g('southNavButtonText'); stxt.innerHTML = 'No path';
			var wtxt = g('westNavButtonText'); wtxt.innerHTML = 'No path';
			var nbut = g('northNavButton'); nbut.disabled = true;
			var ebut = g('eastNavButton'); ebut.disabled = true;
			var sbut = g('southNavButton'); sbut.disabled = true;
			var wbut = g('westNavButton'); wbut.disabled = true;
			
			var txt = null;
			var but = null;
			for (var i=0;i<a.exits.length;i++)
			{
				var e = a.exits[i];
				if (e.conditions === null || e.conditions())
				{
					txt = g(e.direction.navButtonText);
					but = g(e.direction.navButton);
					txt.innerHTML = handleWildcards(e.text);
					but.disabled = false;
					but.setAttribute('aria-label', handleWildcards(e.accessibleText));
					but.setAttribute('data-area', a.id);
					but.setAttribute('data-exit', i);
				}
			}
		}
		function populateTabBox()
		{
			switch (selectedTabs.tabBox)
			{
				case 'area':
					populateAreaTab();
					break;
				case 'inventory':
					populateInventoryTab();
					break;
				case 'skills':
					populateSkillsTab();
					break;
					break;
				case 'journal':
					populateJournalTab();
					break;
			}
		}
		function populateAreaTab()
		{
			var a = getArea(characterState.currentArea);
			updateAreaTable(a);
			updateStructuresTable(a);
			updateFeatureTable(a);
			updateAreaNpcsTable(a);
			updateSaleItemsTable(a);
		}
		function areaHasSaleItems(a)
		{
			for (var i=0;i<a.features.length;i++)
			{
				if (a.features[i].type == 'ITEM' && a.features[i].hasOwnProperty('itemStack') && a.features[i].canPurchase)
				{
					return true;
				}
			}
			return false;
		}
		function populateInventoryTab()
		{
			var hasTools = false;
			for (var key in characterState.tools)
			{
				var tool = characterState.tools[key];
				if (tool.level > 0)
				{
					hasTools = true;
				}
			}
			if (hasTools)
			{
				g('toolBox').style.display = 'block';
				g('noToolBox').style.display = 'none';
				updateToolsTable();
			}
			else
			{
				g('toolBox').style.display = 'none';
				g('noToolBox').style.display = 'block';
			}
			var hasInv = false;
			for (var i=0;i<characterState.inventory.length;i++)
			{
				if (characterState.inventory[i].quantity > 0)
				{
					hasInv = true;
					break;
				}
			}
			if (hasInv)
			{
				g('inventoryBox').style.display = 'block';
				g('noInventoryBox').style.display = 'none';
				updateInventoryTable();
			}
			else
			{
				g('inventoryBox').style.display = 'none';
				g('noInventoryBox').style.display = 'block';
			}
		}
		function populateSkillsTab()
		{
			var hasSkills = false;
			for (var key in characterState.skills)
			{
				var skills = characterState.skills[key].level;
				if (skills > 0)
				{
					hasSkills = true;
				}
			}
			if (hasSkills)
			{
				g('skillBox').style.display = 'block';
				g('noSkillBox').style.display = 'none';
			}
			else
			{
				g('skillBox').style.display = 'none';
				g('noSkillBox').style.display = 'block';
			}
			updateSkillsTable();
		}

		function getPluralizedItemName(item, quantity)
		{
			return (quantity > 1 || quantity == 0) ? item.pluralName : item.displayName;
		}
		function renderEmoji(emoji, n, label, stacked = false)
		{
			var r = ce('span');
			for (var i=0;i<n;i++)
			{
				var s = ce('span');
				if (stacked)
				{
					s.className = 'stackedEmoji';
				}
				s.innerHTML = emoji;
				s.setAttribute('aria-hidden', 'true');
				r.appendChild(s);
			}
			r.setAttribute('aria-role', 'img');
			r.setAttribute('aria-label', label);
			r.setAttribute('title', label);
			r.className = 'emoji';
			return r;
		}
		function renderStars(n, stacked = false)
		{
			return renderEmoji(STAR_ICON, n, n + ' star', stacked);
		}
		function renderHearts(n, stacked = false)
		{
			return renderEmoji(HEART_ICON_RED, n, n + ' heart', stacked);
		}
		function renderHourglasses(n, stacked = false)
		{
			return renderEmoji(HOURGLASS_ICON, n, n + ' hourglass', stacked);
		}
	</script>
	<script> // skill calc functions
		function getEarlyBirdMinutes()
		{
			var n = characterState.skills.earlyBird.level;
			return Math.max(1, Math.round((Math.pow(n, 2)+(n-1)) / 5 * 2.5));
		}
		function getNightOwlMinutes()
		{
			var n = characterState.skills.nightOwl.level;
			return Math.max(1, Math.round((Math.pow(n, 2)+(n-1)) / 5) * 5);
		}
		function getWakeUpTime()
		{
			// 6am
			return 360 - getEarlyBirdMinutes();
		}
		function getPassOutTime()
		{
			// minutes in a day (midnight)
			return 1440 + getNightOwlMinutes();
		}
		function getForagedBonusChance()
		{
			var n = characterState.skills.foraging.level;
			return n;
		}
		function getForagedBonusQuantity()
		{
			var n = characterState.skills.foraging.level;
			return Math.round(n / 2);
		}
		function getForagedItemQuantity(quantity)
		{
			var n = characterState.skills.foraging.level;
			return Math.round(quantity * (1 + (n * (100 / 15) / 100)));
		}
		function getCookingUpgradeChance(level)
		{
			return Math.max(0, characterState.skills.cooking.level - level) * 5;
		}
	</script>
	<script> // tool functions
		function updateToolsTable()
		{
			var x = g('toolTableBody');
			x.innerHTML = '';
			
			for (var key in characterState.tools)
			{
				var tool = characterState.tools[key];
				
				if (tool.level > 0)
				{
					var row = ce('tr');
					var nameTd = ce('td');
					var actionTd = ce('td');

					nameTd.innerHTML = tool.displayName;
					if (tool.level > 1)
					{
						nameTd.appendChild(renderStars(tool.level-1, true));
					}
					actionTd.appendChild(makeToolInspectbutton(tool));

					row.appendChild(nameTd);
					row.appendChild(actionTd);
					x.appendChild(row);
				}
			}
		}
		function makeToolInspectbutton(tool)
		{
			return makeButton('ochreButton', function(){inspectTool(this);}, INSPECT_ICON, 'Inspect ' + tool.displayName, {toolId: tool.id});
		}
		function inspectTool(toolButton)
		{
			if (characterState.tools.hasOwnProperty(toolButton.getAttribute('data-toolid')))
			{
				var tool = characterState.tools[toolButton.getAttribute('data-toolid')];
				addAlertNarration(tool.descriptions[Math.min(tool.descriptions.length-1, tool.level)] + ' ' + tool.toolTip);
			}
			else
			{
				addAlertNarration('No description available.');
			}
		}
		function upgradeTool(character, id, level)
		{
			if (character.tools.hasOwnProperty(id))
			{
				character.tools[id].level = (level !== null) ? level : character.tools[id].level + 1;
				populateInventoryTab();
			}
			return getToolLevel(id);
		}
		function getToolLevel(id)
		{
			if (characterState.tools.hasOwnProperty(id))
			{
				return characterState.tools[id].level;
			}
			return 0;
		}
		function pickupTool(button)
		{
			var id = button.getAttribute('data-tool');
			var level = button.getAttribute('data-level');
			if (getToolLevel(id) >= level)
			{
				addAlertNarration('You don\'t need this tool. You\'ve already got one.');
			}
			else
			{
				var tool = characterState.tools[id];
				upgradeTool(characterState, id, level);
				if (level > 1)
				{
					addAlertNarration('You\'ve upgraded your ' + getFuncOrVar(tool.displayName) + '. You don\'t need this old one anymore.');
				}
				else
				{
					addAlertNarration('You\'ve acquired a ' + getFuncOrVar(tool.displayName) + '.');
				}
				deleteFeature(button.getAttribute('data-area'), button.getAttribute('data-feature'));
			}
		}
	</script>
	<script> // skill functions
		function updateSkillsTable()
		{
			var x = g('skillTableBody');
			x.innerHTML = '';
			hideSkillInterfaces();
			for (var key in characterState.skills)
			{
				var skill = characterState.skills[key];
				
				if (skill.level > 0)
				{
					var row = ce('tr');
					var nameTd = ce('td');
					var levelTd = ce('td');
					var actionTd = ce('td');

					nameTd.innerHTML = skill.displayName;
					levelTd.innerHTML = skill.level;
					switch (skill.id)
					{
						case 'cooking':
							actionTd.appendChild(makeButton('ochreButton', function(){openSkillInterface('cooking');}, 'Cook', 'Cook'));
							break;
					}
					actionTd.appendChild(makeSkillInspectbutton(skill));

					row.appendChild(nameTd);
					row.appendChild(levelTd);
					row.appendChild(actionTd);
					x.appendChild(row);
				}
			}

			if (characterState.knownRecipes.length > 0)
			{
				g('knownRecipesBox').style.display = 'block';
				g('noRecipesBox').style.display = 'none';
				g('notNearCookingFeature').style.display = 'none';
				g('requiredIngredientsBox').style.display = 'none';
				var sel = g('knownRecipesDropDown');
				sel.innerHTML = '<option value="" selected>--Select Recipe--</option>';
				for (var i=0;i<characterState.knownRecipes.length;i++)
				{
					var rec = getRecipe(characterState.knownRecipes[i]);
					var res = getItem(rec.result.item);
					var o = ce('option');
					o.value = rec.id;
					o.innerHTML = ucaseName(res.displayName + ((rec.result.quantity > 1) ? (' x' + rec.result.quantity) : ''));
					sel.appendChild(o);
				}
			}
			else
			{
				g('knownRecipesBox').style.display = 'none';
				g('noRecipesBox').style.display = 'block';
			}
		}
		function makeSkillInspectbutton(skill)
		{
			return makeButton('ochreButton', function(){inspectSkill(this);}, INSPECT_ICON, 'Inspect ' + skill.displayName, {skillId: skill.id});
		}
		function inspectSkill(skillButton)
		{
			if (characterState.skills.hasOwnProperty(skillButton.getAttribute('data-skillid')))
			{
				var skill = characterState.skills[skillButton.getAttribute('data-skillid')];
				addAlertNarration(skill.description);
			}
			else
			{
				addAlertNarration('No description available.');
			}
		}
		function upgradeSkill(character, id, level, message)
		{
			if (character.skills.hasOwnProperty(id))
			{
				var prevLevel = character.skills[id].level;
				character.skills[id].level = (level !== null) ? level : character.skills[id].level + 1;
				if (message && character.skills[id].level > prevLevel)
				{
					addAlertNarration('Your ' + character.skills[id].displayName + ' skill has increased to ' + character.skills[id].level + '.');
				}
				populateSkillsTab();
			}
			return getSkillLevel(character, id);
		}
		function getSkillLevel(character, id)
		{
			if (characterState.skills.hasOwnProperty(id.toLowerCase()))
			{
				return characterState.skills[id.toLowerCase()].level;
			}
			return 0;
		}
		function hideSkillInterfaces()
		{
			var interfaces = document.getElementsByClassName('skillInterface');
			for (var i=0;i<interfaces.length;i++)
			{
				interfaces[i].style.display = 'none';
			}
		}
		function openSkillInterface(skillId)
		{
			hideSkillInterfaces();
			var skillInterface = g(skillId + 'Interface');
			if (skillInterface !== null && skillInterface !== undefined)
			{
				skillInterface.style.display = 'block';
			}
		}
	</script>
	<script> // skill action functions
		function tryFishingInWater(area, feature)
		{
			if (characterState.skills.fishing.level < 1)
			{
				addAlertNarration('It\'s been a while since you\'ve gone fishing. You\'ll need a rod and some bait, and it wouldn\'t hurt to talk to a local angler for some pointers.');
			}
			else
			{
				if (characterState.tools.fishingRod.level < 1)
				{
					addAlertNarration('You\'ll need to acquire a fishing rod first. Try looking in some of the local shops or talk to some anglers.');
				}
				else
				{
					var a = getArea(area);
					var f = getFeature(feature);
					if (characterState.tools.fishingRod < f.level)
					{
						addAlertNarration('You\'ll need to upgrade your fishing rod to fish here.');
					}
					else
					{
						addNarrationMessage('yerp');
					}
				}
			}
		}
		function getRecipe(recipe)
		{
			var recId = recipe;
			if (typeof(recipe) === 'object')
			{
				if (recipe.hasOwnProperty('ingredients')) { return recipe; }
				if ('tagName' in recipe)
				{
					recId = item.getAttribute('data-recipeid');
				}
			}
			for (var i=0;i<recipes.length;i++)
			{
				if (recipes[i].id == recId) { return recipes[i]; }
			}
			return null;
		}
		function selectRecipeToCook(recipe)
		{
			if (recipe != '' && recipe !== null && recipe !== undefined)
			{
				var area = getArea(characterState.currentArea);		
				var r = getRecipe(recipe);
				if (canCookRecipeInArea(r, area))
				{
					g('requiredIngredientsList').innerHTML = '';
					g('notNearCookingFeature').style.display = 'none';
					g('dontHaveIngredientsMessage').style.display = 'none';
					g('cookButton').style.display = 'none';
					for (var i=0;i<r.ingredients.length;i++)
					{
						var iStack = r.ingredients[i];
						var n = countInventoryItem(iStack.item, iStack.level);
						var li = ce('li');
						if (n > 0)
						{
							li.appendChild(makeIngredientSelectBox(iStack));
						}
						else
						{
							var it = getItem(iStack.item);
							li.innerHTML = ucaseName(getFuncOrVar(it.displayName));
							g('dontHaveIngredientsMessage').style.display = 'block';
						}
						g('requiredIngredientsList').appendChild(li);
					}
					if (g('dontHaveIngredientsMessage').style.display == 'none')
					{
						g('cookButton').innerHTML = r.action;
						g('cookButton').style.display = 'inline';
					}
					g('requiredIngredientsBox').style.display = 'block';
				}
				else
				{
					g('notNearCookingFeature').style.display = 'block';
					g('requiredIngredientsBox').style.display = 'none';
				}
			}
			else
			{
				g('requiredIngredientsBox').style.display = 'none';
				g('notNearCookingFeature').style.display = 'none';
				g('noRecipesBox').style.display = 'none';
			}
		}
		function makeIngredientSelectBox(stack)
		{
			var sel = ce('select')
			sel.id = getIngredientSelectId(stack);
			var stacks = getAllInvetoryItemsAtLevel(stack.item, stack.level);
			for (var i=0;i<stacks.length;i++)
			{
				var o = ce('option');
				var item = getItem(stacks[i].item);
				o.value = item.id;
				o.setAttribute('data-itemLevel', stacks[i].level);
				o.innerHTML = ucaseName(getFuncOrVar(item.displayName)) + renderStars(stacks[i].level, true).outerHTML;
				sel.className = 'cookingIngredientSelect';
				sel.appendChild(o);
			}
			return sel;
		}
		function getIngredientId(stack)
		{
			return stack.item.id + '_' + stack.level + '_' + stack.quantity;
		}
		function getIngredientSelectId(stack)
		{
			return 'ingredientSelect_' + getIngredientId(stack);
		}
		function tryCookRecipe(recipe, selectedIngredients)
		{
			var rec = recipe;
			if (recipe === null || recipe === undefined)
			{
				rec = g('knownRecipesDropDown').value;
			}
			rec = getRecipe(rec);
			
			if (testTime(rec.time, false, false))
			{
				if (rec != '' && rec !== null && rec !== undefined)
				{
					var usableIngredients = [];
					for (var i=0;i<rec.ingredients.length;i++)
					{
						var ingredientId = getIngredientId(rec.ingredients[i]);
						var selectedIngredient = null;
						if (selectedIngredients === null || selectedIngredients === undefined
							|| !selectedIngredients.hasOwnProperty(ingredientId))
						{
							var x = g(getIngredientSelectId(rec.ingredients[i]));
							if (x !== null && x !== undefined)
							{
								selectedIngredient = newItemStack(x.value, 
									x.options[x.selectedIndex].getAttribute('data-itemLevel'), rec.ingredients[i].quantity);
							}
						}
						else
						{
							selectedIngredient = selectedIngredients[ingredientId];
						}
						if (selectedIngredient !== null)
						{
							usableIngredients.push(getInventoryItem(selectedIngredient.item, selectedIngredient.level));
						}
						else
						{
							addAlertNarration('There was a problem with one of your ingredients.');
							return false;
						}
					}
					cookRecipe(rec, usableIngredients);
				}
				else
				{
					addAlertNarration('Invalid recipe.');
					return false;
				}
			}
			else
			{
				addAlertNarration('You don\'t have time to cook this tonight.');
			}
		}
		function cookRecipe(recipe, inventoryIngredients)
		{ //TODO fix cooking so that it uses tryAddInventory function before the tryRemoveInventory call
			var rec = getRecipe(recipe);
			var totalIngredientLevel = 0;
			for (var i=0;i<inventoryIngredients.length;i++)
			{
				if (!tryRemoveInventory(inventoryIngredients[i].item, inventoryIngredients[i].level, inventoryIngredients[i].quantity, false))
				{
					addAlertNarration('There was an issue cooking this item.');
					return false;
				}
				totalIngredientLevel += inventoryIngredients[i].level;
			}
			var avgIngLevel = totalIngredientLevel / inventoryIngredients.length;
			if (roll((avgIngLevel - Math.floor(avgIngLevel)) * 100))
			{
				avgIngLevel++;
			}
			var res = getItem(rec.result.item);
			addAlertNarration(ucaseName(getFuncOrVar(res.displayName)) + ((rec.result.quantity > 1) ? ' x' + rec.result.quantity : '') + ' added to your inventory.');
			addItemToInventory(rec.result.item, getCookedResultLevel(avgIngLevel, rec.result.level), rec.result.quantity);
			addTime(rec.time);
			updateDisplay();
		}
		function getCookedResultLevel(ingredientLevel, recipelevel)
		{
			var level = ingredientLevel + recipelevel;
			if (roll(getCookingUpgradeChance(level)))
			{
				return level + 1;
			}
			return level;
		}
	</script>
</head>
<body>
	<main role="main">
		<div id="gameBox" data-subcontent-type="layout" data-subcontent-default="block" data-subcontent="pregame" data-mode="normal">
			<h1>Smalltown v0.1a</h1>
			<div id="narrationBox" aria-live="assertive" role="alert"></div>
			<div id="controlsBox">
				<div id="layout-pregame" class="subcontent layout">
					<button id="continueButton" class="menuButton ochreButton" onclick="continueGame(false);"><span>Continue</span></button><br />
					<button id="newGameButton" class="menuButton greenButton" onclick="startNewGame(false);"><span>New Game</span></button><br />
				</div>
				<div id="layout-startNewGame" class="subcontent layout">
					<table style="text-align: left;">
						<tr><td>Your Name:</td><td><input type="text" id="yourNameInput" value="Bosco" /></td></tr>
						<tr><td>Property Name:</td><td><input type="text" id="propNameInput" value="Boss Manor" /></td></tr>
						<tr><td>Sex:</td><td><label for="sexInputMale"> Male:</label><input type="radio" id="sexInputMale" name="sexInput" checked /> <label for="sexInputFemale"> Female:</label><input type="radio" id="sexInputFemale" name="sexInput" /></td></tr>
						<tr><td>Height:</td><td><select id="heightInput"></select></td></tr>
						<tr><td>Body Type:</td><td><select id="bodyTypeInput"></select></td></tr>
						<tr><td>Hair Color:</td><td><select id="hairInput"></select></td></tr>
						<tr><td>Hair Style:</td><td><select id="hairStyleInput"></select></td></tr>
						<tr><td>Eye Color:</td><td><select id="eyeInput"></select></td></tr>
						<tr><td>Aesthetic:</td><td><select id="aestheticInput"></select></td></tr>
					</table>
					<button id="beginButton" class="menuButton greenButton" onclick="loadGame(null);"><span>Begin New Life</span></button><br />
				</div>
				<div id="layout-continueGame" class="subcontent layout">
					<table>
						<thead>
							<tr>
								<th>Save Title</th>
								<th>Play Time</th>
								<th>Last Save Date</th>
							</tr>
						</thead>
						<tbody id="saveListBody">
						</tbody>
					</table>
				</div>
				<div id="layout-main" class="subcontent layout">
					<div id="viewBox" data-subcontent-type="view" data-subcontent-default="block" data-subcontent="currentArea">
						<div id="view-currentArea" class="subcontent view">
							<div>
								<h2>Navigation</h2>
								<div id="navigationButtons">
									<button id="northNavButton" class="navButton blueButton" aria-label="North" data-area="" data-exit="" onclick="clickActionButton(this, clickNavButton);">N: <span id="northNavButtonText"></span></button><br />
									<button id="westNavButton" class="navButton blueButton" aria-label="West" data-area="" data-exit="" onclick="clickActionButton(this, clickNavButton);">W: <span id="westNavButtonText"></span></button>
									<button id="eastNavButton" class="navButton blueButton" aria-label="East" data-area="" data-exit="" onclick="clickActionButton(this, clickNavButton);">E: <span id="eastNavButtonText"></span></button><br />
									<button id="southNavButton" class="navButton blueButton" aria-label="South" data-area="" data-exit="" onclick="clickActionButton(this, clickNavButton);">S: <span id="southNavButtonText"></span></button>
								</div>
							</div>
							<div id="tabBox" data-subcontent-type="tabcontent" data-subcontent-default="block" data-subcontent="area">
								<div class="tabcontrols" style="margin-bottom: 2vh;">
									<div id="mainTab_Area" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-area" onclick="selectTab('tabBox', 'area', 'maintabs', this);"><h4>Area</h4></div>
									<div id="mainTab_Inv" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-inventory" onclick="selectTab('tabBox', 'inventory', 'maintabs', this);"><h4>Inventory</h4></div>
									<div id="mainTab_Skill" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-skills" onclick="selectTab('tabBox', 'skills', 'maintabs', this);"><h4>Skills</h4></div>
									<div id="mainTab_Journal" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-journal" onclick="selectTab('tabBox', 'journal', 'maintabs', this);"><h4>Journal</h4></div>
									<div id="mainTab_Pref" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-preferences" onclick="selectTab('tabBox', 'preferences', 'maintabs', this);"><h4 class="placeholder" data-content="GEAR_ICON" aria-label="Preferences" aria-role="img" style="font-weight: bold; font-size: 1.2em; position: relative; top: -.75vh;"></h4></div>
								</div>
								<div id="tabcontent-area" class="subcontent tabcontent">
									<table id="areaTable" class="itemTable">
										<thead>
											<tr>
												<th>Area</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="areaTableBody"></tbody>
									</table>
									<table id="areaNpcsTable" class="itemTable">
										<thead>
											<tr>
												<th>People</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="areaNpcsBody"></tbody>
									</table>
									<table id="structuresTable" class="itemTable">
										<thead>
											<tr>
												<th>Structure</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="areaStructuresBody"></tbody>
									</table>
									<table id="featuresTable" class="itemTable">
										<thead>
											<tr>
												<th>Feature</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="areaFeaturesBody"></tbody>
									</table>
									<table id="saleItemsTable" class="itemTable">
										<thead>
											<tr>
												<th>For Sale</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="saleItemsBody"></tbody>
									</table>
								</div>
								<div id="tabcontent-inventory" class="subcontent tabcontent">
									<div id="toolBox">
										<table id="toolsTable" class="itemTable">
											<thead>
												<tr>
													<th>Tool</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="toolTableBody"></tbody>
										</table>
									</div>
									<div id="noToolBox"><i>You currently have no tools</i></div>
									<div id="inventoryBox">
										<table id="inventoryTable" class="itemTable">
											<thead>
												<tr>
													<th>Item</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="inventoryTableBody"></tbody>
										</table>
									</div>
									<div id="noInventoryBox"><i>Your inventory is empty</i></div>
								</div>
								<div id="tabcontent-skills" class="subcontent tabcontent">
									<div id="skillBox">
										<table id="skillsTable" class="itemTable">
											<thead>
												<tr>
													<th>Skill</th>
													<th>Level</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="skillTableBody"></tbody>
										</table>
									</div>
									<div id="noSkillBox"><i>You currently have no skills</i></div>
									<hr />
									<div id="cookingInterface" class="skillInterface">
										<h4>Cooking </h4>
										<div id="knownRecipesBox" style="display: none;">
											Recipes: <select id="knownRecipesDropDown" onchange="selectRecipeToCook(this.value)"></select>
											<div id="requiredIngredientsBox" style="display: none;">
												Required Ingredients:
												<ol id="requiredIngredientsList"></ol>
												<button id="cookButton" class="redButton" onclick="tryCookRecipe()"></button>
												<div id="dontHaveIngredientsMessage"><i>You don't have the right ingredients.</i></div>
											</div>
											<div id="notNearCookingFeature" style="display: none;"><i>You don't have anywhere to cook this.</i></div>
										</div>
										<div id="noRecipesBox"><i>You don't know any recipes yet.</i></div>
									</div>
								</div>
								<div id="tabcontent-journal" class="subcontent tabcontent">
									<div id="activeQuestsBox">
										<table id="activeQuestsTable" class="itemTable">
											<thead>
												<tr>
													<th>Active Quests</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="activeQuestsTableBody"></tbody>
										</table>
									</div>
									<div id="noActiveQuestsBox"><i>You currently have no active quests</i></div>
									<hr />
									<div id="completedQuestsBox">
										<table id="completedQuestsTable" class="itemTable">
											<thead>
												<tr>
													<th>Completed Quests</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="completedQuestsTableBody"></tbody>
										</table>
									</div>
									<div id="noCompletedQuestsBox"><i>You haven't completed any quests</i></div>
								</div>
								<div id="tabcontent-preferences" class="subcontent tabcontent">
									<table id="preferencesTable" class="itemTable">
										<thead>
											<tr>
												<th>Preference</th>
												<th>Options</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td>Area Tab on Travel</td>
												<td>
													Yes:<input type="radio" id="pref_areaTabOnTravel_yes" name="areaTabOnTravel" onclick="gamePreferences.areaTabOnTravel = this.checked;" />
													No: <input type="radio" id="pref_areaTabOnTravel_no" name="areaTabOnTravel" onclick="gamePreferences.areaTabOnTravel = !this.checked;" />
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					<div id="statBox" data-subcontent-type="stat" data-subcontent-default="block" data-subcontent="basic">
						<div id="miniCalendar" class="morning clearWeather">
							<span id="currentDayOfWeek"></span>, <span id="currentSeason"></span> <span id="currentSeasonDay"></span> - 
							<span id="timeOfDayHour">6</span>:<span id="timeOfDayMinutes">00</span> <span id="timeOfDayAmPm">AM</span>
							<span id="timeOfDayEmoji" class="sunEmoji" aria-hidden="true"></span>
						</div>
						<div id="stat-basic" class="stat">
							<h4>Stamina: <span id="currentStaminaPercent"></span> - Money: $<span id="currentMoney"></span></h4>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<script> //initialization
		document.onkeyup = handleKeyInput;

		function handleKeyInput(e)
		{
			if (getSubcontent('gameBox') == 'main')
			{
				e = e || window.event;
				switch (e.keyCode)
				{
					case 37: // left
						g('westNavButton').click();
						break;
					case 38: // up
						g('northNavButton').click();
						break;
					case 39: // right
						g('eastNavButton').click();
						break;
					case 40: // down
						g('southNavButton').click();
						break;
				}
			}
		}
		
		function initialize()
		{
			setSubcontent('gameBox', 'pregame');
			var cb = g("continueButton");
			var saves = getGameSaves();
			if (saves !== null && saves.length > 0)
			{
				console.log(saves);
				cb.disabled = false;
				cb.style.display = 'inline';
			}
			else
			{
				cb.disabled = true;
				cb.style.display = 'none';
			}
			clearNarrationBox();
			addNarrationMessage('Pre-alpha release. Bugs may be present, please be patient.');
			addNarrationMessage('Click New Game to start a new game, or Continue if you have a game saved.');
			backfillPlaceholders();
			setupCharacterAppearanceOptions();
		}
		function backfillPlaceholders()
		{
			var placeholders = document.getElementsByClassName('placeholder');
			for (var i=0;i<placeholders.length;i++)
			{
				placeholders[i].innerHTML = eval(placeholders[i].getAttribute('data-content'));
			}
		}
		function setupCharacterAppearanceOptions()
		{
			if (rint(2) == 0) { g('sexInputMale').checked = true; }
			else { g('sexInputFemale').checked = true; }
			
			var c = 0;
			for (var key in heights)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = heights[key].displayName;
				g('heightInput').appendChild(o);
				c++;
			}
			g('heightInput').getElementsByTagName('option')[rint(c)].selected = true;
			c = 0;
			for (var key in bodyTypes)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = bodyTypes[key].displayName;
				g('bodyTypeInput').appendChild(o);
				c++;
			}
			g('bodyTypeInput').getElementsByTagName('option')[rint(c)].selected = true;
			for (var i=0;i<naturalHairColors.length;i++)
			{
				var o = ce('option');
				o.value = naturalHairColors[i];
				o.innerHTML = hairColors[naturalHairColors[i]].displayName;
				g('hairInput').appendChild(o);
			}
			g('hairInput').getElementsByTagName('option')[rint(naturalHairColors.length)].selected = true;
			c = 0;
			for (var key in hairStyles)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = hairStyles[key].displayName;
				g('hairStyleInput').appendChild(o);
				c++;
			}
			g('hairStyleInput').getElementsByTagName('option')[rint(c)].selected = true;
			c = 0;
			for (var key in eyeColors)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = eyeColors[key].displayName;
				g('eyeInput').appendChild(o);
				c++;
			}
			g('eyeInput').getElementsByTagName('option')[rint(c)].selected = true;
			c = 0;
			for (var key in aesthetics)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = aesthetics[key].displayName;
				g('aestheticInput').appendChild(o);
				c++;
			}
			g('aestheticInput').getElementsByTagName('option')[rint(c)].selected = true;			
		}
		initialize();
		
	</script>
</body>
