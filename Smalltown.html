<!doctype html>
<html lang="en">
<head>
	<title>Smalltown</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="0">
	<meta name="description" content="Smalltown - Powered by TextCity Engine">
	<style>
		html *
		{
			font-size: 2.5vh;
			touch-action: manipulation;
		}

		body, html
		{
			height: 100%;
			margin: 0;
			padding: 0;
			width: 100%;
		}
		body
		{
			background: #000000;
			font-family: Arial;
			margin: 0;
		}
		h1
		{
			font-size: 4vh;
			margin-bottom: .5vh;
			margin-top: .5vh;
			text-align: center;
		}
		h2, h3, h4, h5
		{
			font-size: 1em;
			font-weight: normal;
			margin: 0;
			padding: 0;
		}
		div
		{
			vertical-align: top;
		}
		button
		{
			cursor:pointer;
			overflow-x: hidden;
			white-space: nowrap;
		}
		p
		{
			margin: 0 0 1vh 0;
			padding: 0;
		}
		ul
		{
			list-style: none;
			margin: 0;
			padding: 0 0 0 .5vh;
		}
		
		/* landscape */
		@media (min-aspect-ratio: 4/3)
		{
			#gameBox
			{
				width: 112vh;
			}
			#narrationBox
			{
				display: inline-block;
				vertical-align: top;
				height: 90vh;
				width: 53vh;
			}
			#controlsBox
			{
				display: inline-block;
				vertical-align: top;
				width: 53vh;
			}
			#viewBox
			{
				height: 80vh;
			}
			#layout-main
			{
				height: 80vh;
			}
			#view-currentArea
			{
				height: 79vh;
			}
			#tabBox
			{
				height: 63vh;
			}
			.tabcontent
			{
				height: 55vh;
			}
		}

		/* portrait */
		@media (max-aspect-ratio: 4/3)
		{
			#gameBox
			{
				width: 56vh;
			}
			#narrationBox
			{
				display: block;
				height: 20vh;
				margin: 5px;
			}
			#viewBox
			{
				height: 60vh;
			}
			#layout-main
			{
				height: 60vh;
			}
			#view-currentArea
			{
				height: 59vh;
			}
			#tabBox
			{
				height: 43vh;
			}
			.tabcontent
			{
				height: 35vh;
			}
		}
		
		#narrationBox
		{
			color: #000000;
			padding: 0 10px 0 10px;
			border: 1px solid;
			overflow-y: auto;
		}
		#gameBox
		{
			height: 99vh;
			margin-left: auto;
			margin-right: auto;
			padding-top: .5vh;
			text-align: center;
			background: #ffffff;
		}
		#view-currentArea
		{
			border: 1px solid;
		}		
		
		#navigationButtons
		{
			text-align: center;
		}
		
		#miniCalendar
		{
			text-align: center;
		}
		
		.tabcontent
		{
			overflow-y: scroll;
		}
		.itemTable
		{
			width: 100%;
		}
		.itemTable tbody tr td:first-child
		{
			text-align: left;
		}
		.itemTable tbody tr td:last-child
		{
			text-align: right;
		}
		
		/* layout styles */
		.subcontent
		{
			display: none;
		}
		
		/* screen styles */
		#content-pregame
		{
			background: #ffffff;
		}
		
		/* object styles */
		.narrationMessage
		{
			text-align: left;
			text-size: 0.8em;
		}
		.signTextNarrationMessage
		{
			text-align: center;
			font-style: italic;
			text-size: 0.8em;
			border: 1px solid;
			margin: 0 3vh 3vh 3vh;
			padding: 1vh;
		}
		.stackedEmoji ~ .stackedEmoji
		{
			position: relative;
			left: -2.25vh;
		}
		.stackedEmoji ~ .stackedEmoji ~ .stackedEmoji
		{
			position: relative;
			left: -4.5vh;
		}
		.stackedEmoji ~ .stackedEmoji ~ .stackedEmoji ~ .stackedEmoji
		{
			position: relative;
			left: -6.75vh;
		}
		.stackedEmoji ~ .stackedEmoji ~ .stackedEmoji ~ .stackedEmoji ~ .stackedEmoji
		{
			position: relative;
			left: -9vh;
		}
		.sunEmoji
		{
			color: #ffff33;
		}
		.moonEmoji
		{
			color: #ccccff;
		}
		.morning
		{
			background: #bbddff;
			color: #000000;
		}
		.tabcontrols
		{
			border-bottom: 1px solid;
		}
		.tabcontrol
		{
			color: #000000;
			position: relative;
			display: inline-block;
			border-top: 1px solid;
			border-left: 1px solid;
			border-right: 1px solid;
			border-radius: .5vh .5vh 0 0;
			padding: .5vh;
			vertical-align: bottom;
		}
		.tabcontrol[data-selected="true"]
		{
			background: #ffffff;
			height: 3.1vh;
			top: 1px;
		}
		.tabcontrol[data-selected="false"]
		{
			background: #cccccc;
			height: 2.5vh;
		}
		
		.skillInterface
		{
			display: none;
		}
		
		/* button styles */
		.menuButton
		{
			border: .1vh solid #000000;
			color: #ffffff;
			font-size: 4vh;
			height: 10vh;
			margin: .2vh .1vh .2vh .1vh;
			width: 30%;
			white-space: normal;
			word-wrap: break-word;
		}
		.navButton
		{
			width: 45%;
		}
		.navButton:disabled
		{
			opacity: 50%;
		}
		.featureActionButton
		{
			
		}
		.greenButton
		{
			background: #00aa00;
			color: #ffffff;
		}
		.ochreButton
		{
			background: #ddaa00;
			color: #000000;
		}
		.redButton
		{
			background: #aa0000;
			color: #ffffff;
		}
		.blueButton
		{
			background: #0000aa;
			color: #ffffff;
		}
	</style>
	<script src="TextCity.js"></script> 
	<script> // globals
		currentSave.worldState.foragedThisWeek = [];
		modConfig.gamePreferences = {
			areaTabOnTravel: true
		};
	</script>
	<script> // items
		// newItem(id, displayName, pluralName, description, value = 0, maxStack = 999, isQuestItem = false)
		newItem('BEEF', 'beef', 'beef', 'A cut of beef.', 5);
		newItem('BLACKBERRY', 'blackberry', 'blackberries', 'A small black, delicious, berry.', 1);
		newItem('BREAD_CAMPFIRE', 'campfire bread', 'campfire bread', 'A hard, bland bread, cooked in a pot on a campfire.', 30, 1);
		newItem('BREADKNIFE', 'breadknife', 'breadknives', 'A very used, old, breadknife.', 0, 1, true);
		newItem('BURGER_RUSTIC', 'rustic burger', 'rustic burgers', 'A very simple, bland burger made over a campfire.', 55, 1);
		newItem('CHEFSKNIFE', 'chef\'s knife', 'chef\'s knives', 'A once nice knife, it looks like its been thrown around too much.', 0, 1, true);
		newItem('CLEAVER', 'cleaver', 'cleavers', 'A well-loved, used meat cleaver.', 0, 1, true);
		newItem('DOUGH_BASIC', 'basic dough', 'basic doughs', 'An easy, basic, kneaded dough for simple breads.', 20, 1);
		newItem('FLOUR_WHEAT', 'wheat flour', 'wheat flour', 'A fine flour made from wheat.', 5);
		newItem('KABOB_STEAK', 'steak kabob', 'steak kabobs', 'Skewered beef roasted over an open flame.', 20);
		newItem('MARSHMALLOW', 'marshmallow', 'marshmallows', 'A squishy white confection. Good for making s\'mores.', 1);
		newItem('MARSHMALLOW_ROASTED', 'roasted marshmallow', 'roasted marshmallows', 'A marshmallow, roasted over an open flame.', 2);
		newItem('POT_OLD', 'old pot', 'old pots', 'A beat up, old, pot.', 0, 1, true);
		newItem('SPINACH', 'spinach', 'spinach', 'A tasty, leafy green, rich in iron.', 10);
		newItem('SPINACH_SEED', 'spinach seed', 'spinach seeds', 'Seeds to grow spinach.', 5);
		newItem('YEAST', 'yeast', 'yeast', 'A microfungus that is used in breadmaking.', 1);
	</script>
	<script> // type definitions
		modData.types.activities = {
			CHILLING: {displayName: 'chilling'},
			HACKY_SACK: {displayName: 'hacky sacking'},
			EATING: {displayName: 'eating'},
			GAMING: {displayName: 'gaming'},
			HOME: {displayName: 'going home'},
			READING: {displayName: 'reading'},
			SLEEPING: {displayName: 'sleeping'},
			STUDYING: {displayName: 'studying'},
			THINKING: {displayName: 'thinking'},
			WALKING_N: {displayName: 'walking north'},
			WALKING_E: {displayName: 'walking east'},
			WALKING_S: {displayName: 'walking south'},
			WALKING_W: {displayName: 'walking west'},
			WORKING: {displayName: 'working'}
		};
		modData.types.aesthetics = {
			ALT: {displayName: 'alternative'},
			CASUAL: {displayName: 'casual'},
			CUTE: {displayName: 'cute'},
			DAPPER: {displayName: 'dapper'},
			HIPSTER: {displayName: 'hipster'},
			NERDY: {displayName: 'nerdy'},
			RUSTIC: {displayName: 'rustic'}
		};
		modData.types.bodies = {
			AVERAGE: {displayName: 'average'},
			CHUBBY: {displayName: 'chubby'},
			CURVY: {displayName: 'curvy'},
			DADBOD: {displayName: 'dad bod'},
			FIT: {displayName: 'fit'},
			THIN: {displayName: 'thin'}
		};
		modData.types.eyeColors = {
			BLUE: {displayName: 'blue'},
			BROWN: {displayName: 'brown'},
			GREEN: {displayName: 'green'},
			HAZEL: {displayName: 'hazel'}
		};
		//TODO come up with some way for different cooking features to modify results or limit by recipe
		//newFeatureType(id, displayName, description, options = {})
		newFeatureType('CAMPFIRE', 'Camp Fire', 'A circle of rocks that you can load wood into and make a fire. Good for roasting marshmallows, and preparing rustic food.', { canCook: true });
		newFeatureType('DEBRIS', 'Debris', function(f){ return getDebrisDescription(f.level); });
		newFeatureType('ITEM', 'Item', null, { canPickUp: false, canPurchase: false });
		newFeatureType('SIGN', 'Sign');
		newFeatureType('SLEEPINGBAG', 'Sleeping Bag', 'A basic sleeping system. It works, but you won\'t feel totally refreshed after sleeping here.');
		newFeatureType('WATER', function(f){ return f.waterType.displayName; });

		modData.types.fish = {
			BLUEGILL: { level: 0, displayName: 'Bluegill', methods: [fishingMethods.ROD], favoriteBaits: [baitTypes.WORM], peakTime: 6, spring: 50, summer: 35, fall: 10, winter: 5 },
			CATFISH: { level: 0, displayName: 'Catfish', methods: [fishingMethods.ROD], favoriteBaits: [baitTypes.WORM], peakTime: 6, spring: 35, summer: 25, fall: 35, winter: 5 },
			CRAYFISH: { level: 0, displayName: 'Crayfish', methods: [fishingMethods.POT, fishingMethods.ROD], favoriteBaits: [baitTypes.RICH], peakTime: 24, spring: 5, summer: 90, fall: 5, winter: 0 },
			FATHEAD: { level: 0, displayName: 'Fathead Minnow', methods: [fishingMethods.TRAP], favoriteBaits: [baitTypes.STINKY], peakTime: 18, spring: 10, summer: 70, fall: 10, winter: 10 }
		};
		modData.types.forageables = {
			BLACKBERRY: {displayName: 'Blackberry Bush', description: 'A wild blackberry bush riddled with sharp thorns. In the summer, this bush is lush with dark, sweet, berries.', item: modData.items.BLACKBERRY, minQuantity: 20, maxQuantity: 40, conditions: [function(){return calendarState.season == seasons.SUMMER;}]}
		};
		modData.types.hairColors = {
			AUBURN: {displayName: 'auburn'},
			BLACK: {displayName: 'black'},
			BLONDE: {displayName: 'blonde'},
			BROWN: {displayName: 'brown'},
			GREY: {displayName: 'grey'},
			RED: {displayName: 'red'},
			WHITE: {displayName: 'white'},
			BLUE: {displayName: 'blue'},
			GREEN: {displayName: 'green'},
			PINK: {displayName: 'pink'},
			PURPLE: {displayName: 'purple'}
		};
		modData.types.hairColorsNatural = [
			'AUBURN',
			'BLACK',
			'BLONDE',
			'BROWN',
			'GREY',
			'RED',
			'WHITE'
		];
		modData.types.hairStyles = {
			AFRO: {displayName: 'afro'},
			BOB: {displayName: 'bob cut'},
			BUN: {displayName: 'bun'},
			CREW: {displayName: 'crew cut'},
			FLAT: {displayName: 'flat top'},
			MANBUN: {displayName: 'man-bun'},
			MOHAWK: {displayName: 'mohawk'},
			PIGTAIL: {displayName: 'pigtails'},
			PONYLOW: {displayName: 'low pony'},
			PONYHIGH: {displayName: 'high pony'},
			PONYUNDER: {displayName: 'undercut pony'},
			SPACEBUNS: {displayName: 'space buns'}
		};
		modData.types.heights = {
			TALL: {displayName: 'tall'},
			AVERAGE: {displayName: 'average'},
			SHORT: {displayName: 'short'}
		};
		modData.types.structures = {
			...modData.types.structures,
			SHOP: { enterAction: 'Enter %%', exitAction: 'Leave %%', isLocked: function() { return !between(calendarState.minutes, hm(8, 59), hm(17), false); } },
			TENT: { level: 1, displayName: 'Tent' },
			HUT: { level: 2, displayName: 'Hut' },
			SHACK: { level: 3, displayName: 'Shack' },
			HOVEL: { level: 4, displayName: 'Hovel' },
			BUNG: { level: 5, displayName: 'Bungalow' },
			COTTAGE: { level: 6, displayName: 'Cottage' },
			HOUSE: { level: 7, displayName: 'House' },
			ESTATE: { level: 8, displayName: 'Estate' },
			VILLA: { level: 9, displayName: 'Villa' },
			MANSION: { level: 10, displayName: 'Mansion' },
			PALACE: { level: 11, displayName: 'Palace' }
		};
		modData.types.waters = {
			POND: { level: 1, displayName: 'Pond' }
		};
	</script>
	<script> // recipes
		//newRecipe (id, displayName, action, ingredients, result, time)
		//TODO add cookingFeatures list to each recipe
		newRecipe('BREAD_CAMPFIRE', 'campfire bread', 'Bake Bread', [newItemStack('DOUGH_BASIC', 0, 1)], newItemStack('BREAD_CAMPFIRE', 0, 1), 30);
		newRecipe('DOUGH_BASIC', 'basic dough', 'Knead Dough', [newItemStack('FLOUR_WHEAT', 0, 1), newItemStack('YEAST', 0, 1)], newItemStack('DOUGH_BASIC', 0, 1), 30);
		newRecipe('KABOB_STEAK', 'steak kabob', 'Roast Kabob', [newItemStack('BEEF', 0, 1)], newItemStack('KABOB_STEAK', 0, 1), 10);
		newRecipe('MARSHMALLOW_ROASTED', 'roasted marshmallow', 'Roast Marshmallow', [newItemStack('MARSHMALLOW', 0, 1)], newItemStack('MARSHMALLOW_ROASTED', 0, 1), 2);
		newRecipe('BURGER_RUSTIC', 'rustic burger', 'Assemble Burger', [newItemStack('BREAD_CAMPFIRE', 0, 1), newItemStack('KABOB_STEAK', 0, 1)], newItemStack('BURGER_RUSTIC', 0, 1), 2);
	</script>
	<script src="Smalltown_areas.js"></script>
	<script src="Smalltown_structures.js"></script>
	
	<script> // npc functions
		function newNPCWorkSchedule(area)
		{
			return newNpcSchedule(area, 'WORKING', [function(){ return isStructureOpen(area);}]);
		}
	</script>
	<script src="Smalltown_npc_avery.js"></script>
	<script src="Smalltown_npc_clayton.js"></script>
	<script src="Smalltown_npc_dominic.js"></script>
	<script src="Smalltown_npc_emma.js"></script>
	<script src="Smalltown_npc_liam.js"></script>
	<script src="Smalltown_npc_luigi.js"></script>
	<script src="Smalltown_npc_mateo.js"></script>
	<script src="Smalltown_npc_olivia.js"></script>
	<script> // npc initialization
		initializeNpcs();
	</script>
	
	<script> // quests
		// newQuest(id, name, description, rewards, triggers, conditions, onComplete)
		newQuest('COOKING_I', 'Commence Cooking I',
				'Collect a breadknife, a cleaver and a chef\'s knife to make a set.',
				'Beginner Knife Set',
				[questTriggers.GAIN_INVENTORY_ITEM],
				[function(cs) {
						return (getInventoryItem('BREADKNIFE').quantity > 0
							&& getInventoryItem('CLEAVER').quantity > 0
							&& getInventoryItem('CHEFSKNIFE').quantity > 0);
					}],
				function(cs) {
						tryRemoveInventory('BREADKNIFE', 0, 1, true);
						tryRemoveInventory('CLEAVER', 0, 1, true);
						tryRemoveInventory('CHEFSKNIFE', 0, 1, true);
						tryRemoveInventory('POT_OLD', 0, 1, true);
						upgradeTool(cs, 'cookingSet', 1);
						addAlertNarration('Cooking Set added to tools.')
						addAlertNarration('You completed the Cooking Set. Now that you\'ve got it, maybe some of the locals will share some of their recipes.');
						startQuest('COOKING_II');
					});
		newQuest('COOKING_II', 'Commence Cooking II',
				'Talk to the local foodies and learn a few techniques.',
				'Level 1 Cooking Skill',
				[questTriggers.LEARN_RECIPE],
				[function(cs) {
						return (characterKnowsRecipe(cs, 'KABOB_STEAK')
							&& characterKnowsRecipe(cs, 'DOUGH_BASIC'));
					}],
				function(cs) {
						addAlertNarration('You\'ve got the tools and a couple basic recipes, now you can begin your cooking career.')
						upgradeSkill(cs, 'cooking', 1, true);
						startQuest('COOKING_III');
					});
		newQuest('COOKING_III', 'Commence Cooking III',
				'Make a basic dough and cook a steak kabob.',
				'New Recipes',
				[questTriggers.COOKRECIPE],
				[function(cs) {
						return (characterHasCookedRecipe(cs, 'KABOB_STEAK') > 0
							&& characterHasCookedRecipe(cs, 'DOUGH_BASIC') > 0);
					}],
				function(cs) {
						addAlertNarration('By tinkering around with your cooking techniques, you\'ve unlocked a few recipes. Now you\'re on your own to learn the ways of the chef.')
						learnRecipe(cs, 'BREAD_CAMPFIRE', true);
						learnRecipe(cs, 'BURGER_RUSTIC', true);
						learnRecipe(cs, 'MARSHMALLOW_ROASTED', true);
					});
	</script>
	<script> // gameplay functions
		function createNewCharacter()
		{
			setSubcontent('gameBox', 'createNewCharacter');
			clearNarration();
			addNarrationMessage('Welcome to Smalltown.');
			addNarrationMessage('You\'ve inherited a large property from your recently deceased relative and decided to uproot your whole life to live here.');
			addNarrationMessage('Tell me a little about yourself:');
		}
		function continueGame()
		{
			setSubcontent('gameBox', 'continueGame');
		}
		function loadNewWorld()
		{
			var name = g('yourNameInput').value;
			var prop = g('propNameInput').value;

			newGame(name);
			updatePropertyName('HOMEPROP', prop);
			currentSave.characterState.appearance = newCharacterAppearance(
				modData.types.heights[g('heightInput').value],
				modData.types.bodies[g('bodyTypeInput').value],
				modData.types.hairColors[g('hairInput').value],
				modData.types.hairColors[g('hairInput').value],
				modData.types.hairStyles[g('hairStyleInput').value],
				modData.types.eyeColors[g('eyeInput').value],
				modData.types.aesthetics[g('aestheticInput').value]
			);
			
			currentSave.characterState.health = 20;
			currentSave.characterState.maxHealth = 20;
			currentSave.characterState.stamina = 20;
			currentSave.characterState.maxStamina = 20;
			currentSave.characterState.money = 0;
			currentSave.characterState.lastBedtime = 1440; // midnight
			currentSave.characterState.ownedAreas.push('HOMEPROP');
			currentSave.characterState.homeProperty = 'HOMEPROP';
			
			if (g('sexInputMale').checked) { currentSave.characterState.sex = 1; }
			else if (g('sexInputFemale').checked) { currentSave.characterState.sex = 0; }
			else { currentSave.characterState.sex = 2; }
			
			startGame();
			setSubcontent('gameBox', 'main');
			setSubcontent('viewBox', 'currentArea');
			setCurrentArea(currentSave.characterState.homeProperty, null);
			selectTab('tabBox', 'area', 'maintabs', g('mainTab_Area'));
		}
		
		function tryClearDebris(stamina, time, area, feature)
		{
			if (testStamina(stamina, staticMessages.NOT_ENOUGH_STAMINA, false))
			{
				if (testTime(time, true, true))
				{
					addAlertNarration('Debris cleared.' + ((time > 60) ? ' Whew!' : ''));
					addStamina(-stamina);
					deleteFeature(area, feature);
					if (!areaHasFeatureType(area, 'DEBRIS'))
					{
						addAlertNarration('All debris has been cleared! New features and paths may now be accessible.');
					}
				}
			}
		}
		function addBoon()
		{
			currentSave.characterState.boon++;
		}
	</script>
	<script> // button handlers
		function clickClearDebrisButton(button)
		{
			var f = getFeature(button.getAttribute('data-feature'));
			tryClearDebris(f.level, 30*Math.pow(2, f.level-1), button.getAttribute('data-area'), button.getAttribute('data-feature'));
		}
		function clickEnterStructureButton(button)
		{
			tryEnterStructure(button.getAttribute('data-structure'));
		}
		function clickLeaveStructureButton(button)
		{
			tryLeaveStructure(button.getAttribute('data-toarea'));
		}
	</script>
	<script> // skill calc functions
		function getEarlyBirdMinutes()
		{
			var n = currentSave.characterState.skills.earlyBird.level;
			return Math.max(1, Math.round((Math.pow(n, 2)+(n-1)) / 5 * 2.5));
		}
		function getNightOwlMinutes()
		{
			var n = currentSave.characterState.skills.nightOwl.level;
			return Math.max(1, Math.round((Math.pow(n, 2)+(n-1)) / 5) * 5);
		}
		function getWakeUpTime()
		{
			// 6am
			return 360 - getEarlyBirdMinutes();
		}
		function getPassOutTime()
		{
			// minutes in a day (midnight)
			return 1440 + getNightOwlMinutes();
		}
		function getForagedBonusChance()
		{
			var n = currentSave.characterState.skills.foraging.level;
			return n;
		}
		function getForagedBonusQuantity()
		{
			var n = currentSave.characterState.skills.foraging.level;
			return Math.round(n / 2);
		}
		function getForagedItemQuantity(quantity)
		{
			var n = currentSave.characterState.skills.foraging.level;
			return Math.round(quantity * (1 + (n * (100 / 15) / 100)));
		}
	</script>
	<script> // feature display functions
		function makeButton(className, action, buttonText, accessibleText, attr)
		{
			var b = ce('button');
			b.className = className;
			b.onclick = action;
			if (accessibleText !== null)
			{
				b.setAttribute('aria-label', handleWildcards(accessibleText));
				b.setAttribute('title', handleWildcards(accessibleText));
			}
			b.innerHTML = handleWildcards(buttonText);
			
			if (attr != null)
			{
				for (var key in attr)
				{
					b.setAttribute('data-' + key, attr[key]);
				}
			}
			return b;
		}
		function makeItemInspectbutton(item)
		{
			return makeButton('ochreButton', function(){inspectItem(this.getAttribute('data-itemid'));}, INSPECT_ICON, 'Inspect ' + item.displayName, {itemid: item.id});
		}
		function makeSkillInspectbutton(skill)
		{
			return makeButton('ochreButton', function(){inspectSkill(this.getAttribute('data-skillid'));}, INSPECT_ICON, 'Inspect ' + skill.displayName, {skillId: skill.id});
		}
		function handleFeatureRow(area, feat)
		{
			var row = null;
			if (feat.type == 'STRUCT_EXIT')
			{
				row = createFeatureRow(feat, { actionFunction: function(){clickActionButton(this, clickLeaveStructureButton);}, text: 'Exit', accessibleText: 'Exit', attr: { toArea: feat.toArea } });
			}			
			else
			{
				if (areaHasFeatureType(area, 'DEBRIS'))
				{
					switch (feat.type)
					{
						case 'DEBRIS':
							row = createFeatureRow(feat, { actionFunction: function(){clickActionButton(this, clickClearDebrisButton);}, text: 'Clear Debris', accessibleText: 'Clear Debris', attr: { area: area.id, feature: feat.id } });
							break;
					}
				}
				else
				{
					var actions = [];
					switch (feat.type)
					{
						case 'FORAGE':
							// TODO reset foraging every week, need daily time cycle done first
							if (!currentSave.worldState.foragedThisWeek.includes(feat.id))
							{
								actions.push({ actionFunction: function(){clickActionButton(this, clickForageButton);}, text: 'Forage', accessibleText: 'Forage from ' + getFeatureDisplayName(feat), attr: { area: area.id, feature: feat.id} });
							}
							break;
						case 'ITEM':
							if (feat.hasOwnProperty('actions'))
							{
								for (var key in feat.actions)
								{
									var act = feat.actions[key];
									actions.push({ actionFunction: act.actionFunction, text: act.text, accessibleText: act.accessibleText, attr: { area: area.id, feature: feat.id, ...act.attr} });
								}
							}
							if (feat.options.hasOwnProperty('canPickUp') && feat.options.canPickUp)
							{
								actions.push({ actionFunction: function(){clickActionButton(this, clickTakeItemButton);}, text: 'Take', accessibleText: 'Take ' + getFeatureDisplayName(feat), attr: { area: area.id, feature: feat.id, itemId: feat.itemStack.item, itemLevel: feat.itemStack.level, itemQuantity: feat.itemStack.quantity } });
							}
							break;
						case 'WATER':
							actions.push({ actionFunction: function(){clickActionButton(this, clickFishButton);}, text: 'Fish', accessibleText: 'Fish in ' + getFeatureDisplayName(feat), attr: { area: area.id, feature: feat.id } });
							break;
					}
					row = createFeatureRow(feat, actions);
				}
			}
			return row;
		}
		function createFeatureRow(feat, actions)
		{
			var row = ce('tr');
			var nameTd = ce('td');
			var actionTd = ce('td');
			nameTd.innerHTML = ucaseName(getFeatureDisplayName(feat));
			if (feat.type == 'ITEM' && feat.canPurchase && feat.hasOwnProperty('itemStack'))
			{
				var price = ce('span');
				price.innerHTML = ': $' + feat.itemStack.item.value;
				nameTd.appendChild(price);
			}
			if (feat.level > 0)
			{
				nameTd.appendChild(renderStars(feat.level, true));
			}			
			if (actions !== null && actions !== undefined)
			{
				if (Array.isArray(actions))
				{
					for (var i=0;i<actions.length;i++)
					{
						actionTd.appendChild(makeFeatureActionButton(actions[i].actionFunction, actions[i].text, actions[i].accessibleText, actions[i].attr));
					}
				}
				else
				{
					actionTd.appendChild(makeFeatureActionButton(actions.actionFunction, actions.text, actions.accessibleText, actions.attr));
				}
			}
			actionTd.appendChild(makeFeatureInspectbutton(feat));
			row.appendChild(nameTd);
			row.appendChild(actionTd);
			return row;
		}

		function makeFeatureActionButton(action, buttonText, accessibleText, attr)
		{
			return makeButton('ochreButton', action, buttonText, accessibleText, attr);
		}
		function makeFeatureInspectbutton(feat)
		{
			return makeButton('ochreButton', function(){inspectFeature(this);}, INSPECT_ICON, 'Inspect ' + getFeatureDisplayName(feat), {featureId: feat.id});
		}
		function makeStructureInspectbutton(struct)
		{
			return makeButton('ochreButton', function(){inspectStructure(this);}, INSPECT_ICON, 'Inspect ' + getFuncOrVar(struct.displayName), {structureId: struct.id});
		}
		function makeNpcInspectbutton(n)
		{
			return makeButton('ochreButton', function(){inspectNpc(this);}, INSPECT_ICON, 'Inspect ' + getFuncOrVar(n.firstName), {npcId: n.id});
		}
		
		function appendNarrationBox(message, className)
		{
			var nar = g('narrationBox');
			var p = ce('p');
			if (Array.isArray(message))
			{
				var t = [];
				for (var i=0;i<message.length;i++)
				{
					t.push(handleWildcards(message[i]))
				}
				p.innerHTML = t.join('<br />');
			}
			else { p.innerHTML = handleWildcards(message); }
			p.className = className;
			nar.appendChild(p);
		}
		function scrollNarrationToBottom()
		{
			var nar = g('narrationBox');
			nar.scrollTop = nar.scrollHeight;
		}
	</script>
	<script> // misc functions
		function getDebrisDescription(level)
		{
			var adjs = [...sizeLevels];
			var a = adjs[Math.min(level, adjs.length-1)];
			return 'A' + n(a) + ' ' + a + ' pile of debris. You\'ll have to clear this out before you can do any work or access any features here.';
		}
		function getNpcAttraction(npc, app)
		{
			var r = 0;
			var n = currentSave.worldState.npcs[npc];
			r += (n.personalPreferences.includes(app.bodyType)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.aesthetic)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.eyes)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.currentHairColor)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.hairStyle)) ? 1 : 0;
			r += (n.personalPreferences.includes(app.height)) ? 1 : 0;
			r += (n.personalPreferences.includes(attractors.DYED_HAIR) && app.currentHair != app.naturalHairColor) ? 1 : 0;
			
			return r;
		}
	</script>
	<script src="Smalltown_modHooks.js"></script> 
</head>
<body>
	<main role="main">
		<div id="gameBox" data-subcontent-type="layout" data-subcontent-default="block" data-subcontent="pregame" data-mode="normal">
			<h1>Smalltown v0.1a</h1>
			<div id="narrationBox" aria-live="assertive" role="alert"></div>
			<div id="controlsBox">
				<div id="layout-pregame" class="subcontent layout">
					<button id="continueButton" class="menuButton ochreButton" onclick="continueGame(false);"><span>Continue</span></button><br />
					<button id="newGameButton" class="menuButton greenButton" onclick="createNewCharacter(false);"><span>New Game</span></button><br />
				</div>
				<div id="layout-createNewCharacter" class="subcontent layout">
					<table style="text-align: left;">
						<tr><td>Your Name:</td><td><input type="text" id="yourNameInput" value="Bosco" /></td></tr>
						<tr><td>Property Name:</td><td><input type="text" id="propNameInput" value="Boss Manor" /></td></tr>
						<tr><td>Sex:</td><td><label for="sexInputMale"> Male:</label><input type="radio" id="sexInputMale" name="sexInput" checked /> <label for="sexInputFemale"> Female:</label><input type="radio" id="sexInputFemale" name="sexInput" /></td></tr>
						<tr><td>Height:</td><td><select id="heightInput"></select></td></tr>
						<tr><td>Body Type:</td><td><select id="bodyTypeInput"></select></td></tr>
						<tr><td>Hair Color:</td><td><select id="hairInput"></select></td></tr>
						<tr><td>Hair Style:</td><td><select id="hairStyleInput"></select></td></tr>
						<tr><td>Eye Color:</td><td><select id="eyeInput"></select></td></tr>
						<tr><td>Aesthetic:</td><td><select id="aestheticInput"></select></td></tr>
					</table>
					<button id="beginButton" class="menuButton greenButton" onclick="loadNewWorld();"><span>Begin New Life</span></button><br />
				</div>
				<div id="layout-continueGame" class="subcontent layout">
					<table>
						<thead>
							<tr>
								<th>Save Title</th>
								<th>Play Time</th>
								<th>Last Save Date</th>
							</tr>
						</thead>
						<tbody id="saveListBody">
						</tbody>
					</table>
				</div>
				<div id="layout-main" class="subcontent layout">
					<div id="viewBox" data-subcontent-type="view" data-subcontent-default="block" data-subcontent="currentArea">
						<div id="view-currentArea" class="subcontent view">
							<div>
								<h2>Navigation</h2>
								<div id="navigationButtons">
									<button id="northNavButton" class="navButton blueButton" aria-label="North" data-area="" data-exit="" onclick="clickActionButton(this, clickNavButton);">N: <span id="northNavButtonText"></span></button><br />
									<button id="westNavButton" class="navButton blueButton" aria-label="West" data-area="" data-exit="" onclick="clickActionButton(this, clickNavButton);">W: <span id="westNavButtonText"></span></button>
									<button id="eastNavButton" class="navButton blueButton" aria-label="East" data-area="" data-exit="" onclick="clickActionButton(this, clickNavButton);">E: <span id="eastNavButtonText"></span></button><br />
									<button id="southNavButton" class="navButton blueButton" aria-label="South" data-area="" data-exit="" onclick="clickActionButton(this, clickNavButton);">S: <span id="southNavButtonText"></span></button>
								</div>
							</div>
							<div id="tabBox" data-subcontent-type="tabcontent" data-subcontent-default="block" data-subcontent="area">
								<div class="tabcontrols" style="margin-bottom: 2vh;">
									<div id="mainTab_Area" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-area" onclick="selectTab('tabBox', 'area', 'maintabs', this);"><h4>Area</h4></div>
									<div id="mainTab_Inv" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-inventory" onclick="selectTab('tabBox', 'inventory', 'maintabs', this);"><h4>Inventory</h4></div>
									<div id="mainTab_Skill" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-skills" onclick="selectTab('tabBox', 'skills', 'maintabs', this);"><h4>Skills</h4></div>
									<div id="mainTab_Journal" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-journal" onclick="selectTab('tabBox', 'journal', 'maintabs', this);"><h4>Journal</h4></div>
									<div id="mainTab_Pref" class="tabcontrol maintabs" data-tabcontrolfor="tabcontent-preferences" onclick="selectTab('tabBox', 'preferences', 'maintabs', this);"><h4 class="placeholder" data-content="GEAR_ICON" aria-label="Preferences" aria-role="img" style="font-weight: bold; font-size: 1.2em; position: relative; top: -.75vh;"></h4></div>
								</div>
								<div id="tabcontent-area" class="subcontent tabcontent">
									<table id="areaTable" class="itemTable">
										<thead>
											<tr>
												<th>Area</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="areaTableBody"></tbody>
									</table>
									<table id="areaNpcsTable" class="itemTable">
										<thead>
											<tr>
												<th>People</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="areaNpcsBody"></tbody>
									</table>
									<table id="structuresTable" class="itemTable">
										<thead>
											<tr>
												<th>Structure</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="areaStructuresBody"></tbody>
									</table>
									<table id="featuresTable" class="itemTable">
										<thead>
											<tr>
												<th>Feature</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="areaFeaturesBody"></tbody>
									</table>
									<table id="saleItemsTable" class="itemTable">
										<thead>
											<tr>
												<th>For Sale</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="saleItemsBody"></tbody>
									</table>
								</div>
								<div id="tabcontent-inventory" class="subcontent tabcontent">
									<div id="toolBox">
										<table id="toolsTable" class="itemTable">
											<thead>
												<tr>
													<th>Tool</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="toolTableBody"></tbody>
										</table>
									</div>
									<div id="noToolBox"><i>You currently have no tools</i></div>
									<div id="inventoryBox">
										<table id="inventoryTable" class="itemTable">
											<thead>
												<tr>
													<th>Item</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="inventoryTableBody"></tbody>
										</table>
									</div>
									<div id="noInventoryBox"><i>Your inventory is empty</i></div>
								</div>
								<div id="tabcontent-skills" class="subcontent tabcontent">
									<div id="skillBox">
										<table id="skillsTable" class="itemTable">
											<thead>
												<tr>
													<th>Skill</th>
													<th>Level</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="skillTableBody"></tbody>
										</table>
									</div>
									<div id="noSkillBox"><i>You currently have no skills</i></div>
									<hr />
									<div id="cookingInterface" class="skillInterface">
										<h4>Cooking </h4>
										<div id="knownRecipesBox" style="display: none;">
											Recipes: <select id="knownRecipesDropDown" onchange="selectRecipeToCook(this.value)"></select>
											<div id="requiredIngredientsBox" style="display: none;">
												Required Ingredients:
												<ol id="requiredIngredientsList"></ol>
												<button id="cookButton" class="redButton" onclick="tryCookRecipe()"></button>
												<div id="dontHaveIngredientsMessage"><i>You don't have the right ingredients.</i></div>
											</div>
											<div id="notNearCookingFeature" style="display: none;"><i>You don't have anywhere to cook this.</i></div>
										</div>
										<div id="noRecipesBox"><i>You don't know any recipes yet.</i></div>
									</div>
								</div>
								<div id="tabcontent-journal" class="subcontent tabcontent">
									<div id="activeQuestsBox">
										<table id="activeQuestsTable" class="itemTable">
											<thead>
												<tr>
													<th>Active Quests</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="activeQuestsTableBody"></tbody>
										</table>
									</div>
									<div id="noActiveQuestsBox"><i>You currently have no active quests</i></div>
									<hr />
									<div id="completedQuestsBox">
										<table id="completedQuestsTable" class="itemTable">
											<thead>
												<tr>
													<th>Completed Quests</th>
													<th>Actions</th>
												</tr>
											</thead>
											<tbody id="completedQuestsTableBody"></tbody>
										</table>
									</div>
									<div id="noCompletedQuestsBox"><i>You haven't completed any quests</i></div>
								</div>
								<div id="tabcontent-preferences" class="subcontent tabcontent">
									<table id="preferencesTable" class="itemTable">
										<thead>
											<tr>
												<th>Preference</th>
												<th>Options</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td>Area Tab on Travel</td>
												<td>
													Yes:<input type="radio" id="pref_areaTabOnTravel_yes" name="areaTabOnTravel" onclick="modConfig.gamePreferences.areaTabOnTravel = this.checked;" />
													No: <input type="radio" id="pref_areaTabOnTravel_no" name="areaTabOnTravel" onclick="modConfig.gamePreferences.areaTabOnTravel = !this.checked;" />
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					<div id="statBox" data-subcontent-type="stat" data-subcontent-default="block" data-subcontent="basic">
						<div id="miniCalendar" class="morning clearWeather">
							<span id="currentDayOfWeek"></span>, <span id="currentSeason"></span> <span id="currentSeasonDay"></span> - 
							<span id="timeOfDayHour">6</span>:<span id="timeOfDayMinutes">00</span> <span id="timeOfDayAmPm">AM</span>
							<span id="timeOfDayEmoji" class="sunEmoji" aria-hidden="true"></span>
						</div>
						<div id="stat-basic" class="stat">
							<h4>Stamina: <span id="currentStaminaPercent"></span> - Money: $<span id="currentMoney"></span></h4>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<script> //initialization
		function initialize()
		{
			setSubcontent('gameBox', 'pregame');
			var cb = g("continueButton");
			var saves = getGameSaves();
			if (saves !== null && saves.length > 0)
			{
				console.log(saves);
				cb.disabled = false;
				cb.style.display = 'inline';
			}
			else
			{
				cb.disabled = true;
				cb.style.display = 'none';
			}
			clearNarration();
			addNarrationMessage('Pre-alpha release. Bugs may be present, please be patient.');
			addNarrationMessage('Click New Game to start a new game, or Continue if you have a game saved.');
			
			//backfill placeholders
			var placeholders = document.getElementsByClassName('placeholder');
			for (var i=0;i<placeholders.length;i++)
			{
				placeholders[i].innerHTML = eval(placeholders[i].getAttribute('data-content'));
			}

			//set up character options
			var sex = rint(3);
			switch (sex)
			{
				case 0: g('sexInputMale').checked = true; break;
				case 1: g('sexInputFemale').checked = true; break;
				default: g('sexInputOther').checked = true; break;
			}
			
			var c = 0;
			for (var key in modData.types.heights)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = modData.types.heights[key].displayName;
				g('heightInput').appendChild(o);
				c++;
			}
			g('heightInput').getElementsByTagName('option')[rint(c)].selected = true;
			c = 0;
			for (var key in modData.types.bodies)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = modData.types.bodies[key].displayName;
				g('bodyTypeInput').appendChild(o);
				c++;
			}
			g('bodyTypeInput').getElementsByTagName('option')[rint(c)].selected = true;
			for (var i=0;i<modData.types.hairColorsNatural.length;i++)
			{
				var o = ce('option');
				o.value = modData.types.hairColorsNatural[i];
				o.innerHTML = modData.types.hairColors[modData.types.hairColorsNatural[i]].displayName;
				g('hairInput').appendChild(o);
			}
			g('hairInput').getElementsByTagName('option')[rint(modData.types.hairColorsNatural.length)].selected = true;
			c = 0;
			for (var key in modData.types.hairStyles)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = modData.types.hairStyles[key].displayName;
				g('hairStyleInput').appendChild(o);
				c++;
			}
			g('hairStyleInput').getElementsByTagName('option')[rint(c)].selected = true;
			c = 0;
			for (var key in modData.types.eyeColors)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = modData.types.eyeColors[key].displayName;
				g('eyeInput').appendChild(o);
				c++;
			}
			g('eyeInput').getElementsByTagName('option')[rint(c)].selected = true;
			c = 0;
			for (var key in modData.types.aesthetics)
			{
				var o = ce('option');
				o.value = key;
				o.innerHTML = modData.types.aesthetics[key].displayName;
				g('aestheticInput').appendChild(o);
				c++;
			}
			g('aestheticInput').getElementsByTagName('option')[rint(c)].selected = true;
		}
	</script>
</body>
